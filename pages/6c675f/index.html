<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进程间通信补充 | JackCin&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/vuepress-theme-vdoing/img/favicon.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,React,python,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/vuepress-theme-vdoing/assets/css/0.styles.d3d6617d.css" as="style"><link rel="preload" href="/vuepress-theme-vdoing/assets/js/app.ef19247d.js" as="script"><link rel="preload" href="/vuepress-theme-vdoing/assets/js/2.59d30681.js" as="script"><link rel="preload" href="/vuepress-theme-vdoing/assets/js/64.25da2825.js" as="script"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/10.895e47cd.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/100.65264761.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/101.4227158e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/102.f7fe8fb6.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/103.e938df0b.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/104.813d1e73.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/105.9cadadc4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/106.7c77f682.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/107.82ef198e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/108.239ee938.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/109.f41dec57.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/11.afdc1626.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/110.718841c6.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/111.af0c9f6c.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/112.ded809e7.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/113.4b0e2248.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/114.5f1e0cca.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/115.d3bfb97a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/116.bea7171d.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/117.58e52c58.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/118.9f68c88a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/119.68f51359.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/12.d5fdc288.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/120.73fe5367.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/121.51d7018c.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/122.cf65245e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/123.f0409c02.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/13.88195303.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/14.5efb7e20.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/15.5d17711a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/16.d4ee57a8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/17.6241a69b.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/18.5fe1c413.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/19.99d38ce9.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/20.802498de.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/21.d8fe6e3b.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/22.e54fc887.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/23.4d468f03.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/24.80e6b4d1.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/25.fd7335b6.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/26.514dcbb3.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/27.4ba9baf9.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/28.fe7b813f.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/29.92843dc7.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/3.b222f77d.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/30.aa8da716.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/31.c330d000.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/32.aa4aeaf8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/33.efc5afb4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/34.f788eebe.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/35.1c9cb0c9.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/36.98662805.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/37.ee2e1ae8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/38.b99e909b.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/39.99693b52.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/4.8052d648.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/40.886d8383.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/41.a2baf11f.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/42.88d7c3f4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/43.3426d73a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/44.17e65dff.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/45.9f3a181b.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/46.d2bbd4a8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/47.0069af15.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/48.427f0e94.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/49.6e4c55aa.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/5.0a7800d5.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/50.0f9664f8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/51.54e3e0f5.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/52.c6861735.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/53.56794768.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/54.5422e26a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/55.34e95002.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/56.09649c5a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/57.79c5317f.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/58.c4607eea.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/59.001ead66.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/6.f4a7523e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/60.f509a114.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/61.a2f3e83c.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/62.0b55350e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/63.e7f1cfd6.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/65.9dcd5846.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/66.b37138f3.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/67.2498daaf.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/68.3211a118.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/69.d1221121.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/7.122cf2b2.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/70.8b7ff9d4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/71.67dae2cc.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/72.d538ddbc.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/73.2e00bd36.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/74.39b37722.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/75.18b59a37.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/76.e08c97ed.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/77.e1e6855a.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/78.137352f0.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/79.0c8e9414.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/8.3304a2cd.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/80.d2c142fd.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/81.ce37cce5.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/82.12e52dc4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/83.5ae3c013.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/84.2908f5f9.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/85.89eb409e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/86.6197f3b8.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/87.5acaa8b4.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/88.cb33954e.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/89.bec70e95.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/9.2a799cd7.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/90.4d3dbdf5.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/91.9147f662.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/92.2ec1cc34.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/93.f4079504.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/94.128a7998.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/95.ea8b5589.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/96.2494e777.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/97.deea76f2.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/98.4c611d73.js"><link rel="prefetch" href="/vuepress-theme-vdoing/assets/js/99.897092d3.js">
    <link rel="stylesheet" href="/vuepress-theme-vdoing/assets/css/0.styles.d3d6617d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-theme-vdoing/" class="home-link router-link-active"><img src="/vuepress-theme-vdoing/img/logo.png" alt="JackCin's blog" class="logo"> <span class="site-name can-hide">JackCin's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-theme-vdoing/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/vuepress-theme-vdoing/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/html/" class="nav-link">Html</a></li><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/css/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/js基础/" class="nav-link">JavaScript基础</a></li><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/js高级/" class="nav-link">JavaScript高级</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/vue/" class="nav-link"> Vue</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><a href="/vuepress-theme-vdoing/up/" class="link-title">进阶</a> <span class="title" style="display:none;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/d91b9c/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/fee75e/" class="nav-link">Ajax</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-theme-vdoing/linux/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/vuepress-theme-vdoing/计算机基础/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/操作系统/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/数据结构与算法/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="单片机" class="dropdown-title"><a href="/vuepress-theme-vdoing/单片机/" class="link-title">单片机</a> <span class="title" style="display:none;">单片机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/51单片机/" class="nav-link">51单片机</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/6c675f/404" class="nav-link">CC2530</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/vuepress-theme-vdoing/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-theme-vdoing/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/JackCin877/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://jackcin877.github.io/image-hosting/blog/%E5%A4%8F%E7%9B%AE.4npqayre72c0.jpg"> <div class="blogger-info"><h3>JackCin</h3> <span>前端小菜鸡(✪ω✪)</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-theme-vdoing/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/vuepress-theme-vdoing/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>页面</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/html/" class="nav-link">Html</a></li><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/css/" class="nav-link">CSS</a></li></ul></li><li class="dropdown-item"><h4>核心</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/js基础/" class="nav-link">JavaScript基础</a></li><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/js高级/" class="nav-link">JavaScript高级</a></li></ul></li><li class="dropdown-item"><h4>框架</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-theme-vdoing/vue/" class="nav-link"> Vue</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="进阶" class="dropdown-title"><a href="/vuepress-theme-vdoing/up/" class="link-title">进阶</a> <span class="title" style="display:none;">进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/jquery/" class="nav-link">jQuery</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/d91b9c/" class="nav-link">Node</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/fee75e/" class="nav-link">Ajax</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-theme-vdoing/linux/" class="nav-link">Linux</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/vuepress-theme-vdoing/计算机基础/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/操作系统/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/数据结构与算法/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="单片机" class="dropdown-title"><a href="/vuepress-theme-vdoing/单片机/" class="link-title">单片机</a> <span class="title" style="display:none;">单片机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/51单片机/" class="nav-link">51单片机</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/6c675f/404" class="nav-link">CC2530</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/vuepress-theme-vdoing/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/vuepress-theme-vdoing/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/vuepress-theme-vdoing/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/JackCin877/vuepress-theme-vdoing" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统编程入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux 多进程开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-theme-vdoing/pages/67fff0/" class="sidebar-link">进程概述</a></li><li><a href="/vuepress-theme-vdoing/pages/36b9b5/" class="sidebar-link">进程状态转换</a></li><li><a href="/vuepress-theme-vdoing/pages/2d6c09/" class="sidebar-link">进程创建</a></li><li><a href="/vuepress-theme-vdoing/pages/e61d0e/" class="sidebar-link">进程控制</a></li><li><a href="/vuepress-theme-vdoing/pages/3fe48e/" class="sidebar-link">进程间通信</a></li><li><a href="/vuepress-theme-vdoing/pages/6c675f/" aria-current="page" class="active sidebar-link">进程间通信补充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/vuepress-theme-vdoing/pages/6c675f/#一、进程间通信" class="sidebar-link">一、进程间通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_1-进程见通信概述" class="sidebar-link">1.进程见通信概述</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_2-linux下进程间通信概述" class="sidebar-link">2.Linux下进程间通信概述</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-ipc-对象" class="sidebar-link">3.IPC 对象</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-查看-ipc-对象" class="sidebar-link">4.查看 IPC 对象</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-theme-vdoing/pages/6c675f/#二、共享内存" class="sidebar-link">二、共享内存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_1-共享内存概述" class="sidebar-link">1. 共享内存概述</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_2-共享内存实现" class="sidebar-link">2. 共享内存实现</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-共享内存函数调用流程" class="sidebar-link">3.共享内存函数调用流程</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3、共享内存函数" class="sidebar-link">3、共享内存函数</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-1-shmget" class="sidebar-link">3.1 shmget()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-2-shmat" class="sidebar-link">3.2 shmat()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-3-shmdt" class="sidebar-link">3.3 shmdt()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-4-shmctl" class="sidebar-link">3.4 shmctl()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3-5-代码" class="sidebar-link">3.5 代码</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-theme-vdoing/pages/6c675f/#三、消息队列" class="sidebar-link">三、消息队列</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_1、消息队列概念" class="sidebar-link">1、消息队列概念</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_2、消息队列模型" class="sidebar-link">2、消息队列模型</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3、消息队列流程" class="sidebar-link">3、消息队列流程</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4、消息队列函数" class="sidebar-link">4、消息队列函数</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-1-msgget" class="sidebar-link">4.1 msgget()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-2-msgsnd" class="sidebar-link">4.2 msgsnd()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-3-msgrcv" class="sidebar-link">4.3 msgrcv()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-4-msgctl" class="sidebar-link">4.4 msgctl()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4-5-代码" class="sidebar-link">4.5 代码</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-theme-vdoing/pages/6c675f/#四、信号灯-量" class="sidebar-link">四、信号灯/量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_1、-临界资源" class="sidebar-link">1、 临界资源</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_2、信号灯" class="sidebar-link">2、信号灯</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_3、-system-v-信号灯" class="sidebar-link">3、 System V 信号灯</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_4、二值、计数信号灯" class="sidebar-link">4、二值、计数信号灯</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_5、p-v-操作" class="sidebar-link">5、P\V 操作</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_6、信号灯函数" class="sidebar-link">6、信号灯函数</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_6-1-semget" class="sidebar-link">6.1 semget()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_6-2-semctl" class="sidebar-link">6.2 semctl()</a></li><li class="sidebar-sub-header level4"><a href="/vuepress-theme-vdoing/pages/6c675f/#_6-3-semctl" class="sidebar-link">6.3 semctl()</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_7、信号灯函数使用" class="sidebar-link">7、信号灯函数使用</a></li><li class="sidebar-sub-header level3"><a href="/vuepress-theme-vdoing/pages/6c675f/#_8、信号量与共享内存" class="sidebar-link">8、信号量与共享内存</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/vuepress-theme-vdoing/pages/6c675f/#五、进程间通信方式比较" class="sidebar-link">五、进程间通信方式比较</a></li></ul></li><li><a href="/vuepress-theme-vdoing/pages/fbb788/" class="sidebar-link">信号</a></li><li><a href="/vuepress-theme-vdoing/pages/be7168/" class="sidebar-link">共享内存</a></li><li><a href="/vuepress-theme-vdoing/pages/84bc0b/" class="sidebar-link">守护进程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux 多线程开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux 网络编程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/vuepress-theme-vdoing/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/vuepress-theme-vdoing/linux/#Linux" data-v-06225672>Linux</a></li><li data-v-06225672><a href="/vuepress-theme-vdoing/linux/#Linux 多进程开发" data-v-06225672>Linux 多进程开发</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/JackCin877" target="_blank" title="作者" class="beLink" data-v-06225672>JackCin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-09-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">进程间通信补充<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="进程间通信"><a href="#进程间通信" class="header-anchor">#</a> 进程间通信</h1> <h2 id="一、进程间通信"><a href="#一、进程间通信" class="header-anchor">#</a> 一、进程间通信</h2> <h3 id="_1-进程见通信概述"><a href="#_1-进程见通信概述" class="header-anchor">#</a> 1.进程见通信概述</h3> <ul><li>UNIX平台进程通信方式
<ul><li>早期进程间通信方式
<ul><li><strong>管道、有名管道和信号</strong></li></ul></li> <li>AT&amp;T的贝尔实验室 •</li> <li>对Unix早期的进程间通信进行了改进和扩充，形成了“<strong>system V IPC</strong>”，其通信进 程主要局限在<strong>单个计算机内</strong></li> <li>BSD(加州大学伯克利分校的伯克利软件发布中心)
<ul><li>形成了基于**套接字(socket)**的计算机之间的进程间通信机制</li></ul></li></ul></li> <li>Linux继承了上述所有的通信方式</li></ul> <h3 id="_2-linux下进程间通信概述"><a href="#_2-linux下进程间通信概述" class="header-anchor">#</a> 2.Linux下进程间通信概述</h3> <ul><li>常用的进程间通信方式
<ul><li>传统的进程间通信方式
<ul><li><strong>无名管道(pipe)、有名管道(fifo)和信号(signal)</strong></li></ul></li> <li>System V IPC对象
<ul><li><strong>共享内存(share memory)、消息队列(message queue)和信号灯 (semaphore)</strong></li></ul></li> <li>BSD
<ul><li><strong>套接字(socket)</strong></li></ul></li></ul></li></ul> <h3 id="_3-ipc-对象"><a href="#_3-ipc-对象" class="header-anchor">#</a> 3.IPC 对象</h3> <ul><li>IPC(Inter-Process Communication) 进程间通信，提 供了各种进程间通信的方法</li></ul> <p><img src="https://jackcin877.github.io/image-hosting/Linux/561bdc422193dc78c48a4020a9b14dd.3r1h9zgxdr60.webp" alt="561bdc422193dc78c48a4020a9b14dd"></p> <p>举例：</p> <p><img src="https://jackcin877.github.io/image-hosting/Linux/IPC%E5%AF%B9%E8%B1%A1%E4%BE%8B%E5%AD%90.4uwovv25sy20.webp" alt="IPC对象例子"></p> <ul><li>🟩可以不要，然后直接将 <code>shmget</code> 函数里的第一个参数写为 <code>IPC_PRIVATE</code> 这个宏</li></ul> <h3 id="_4-查看-ipc-对象"><a href="#_4-查看-ipc-对象" class="header-anchor">#</a> 4.查看 IPC 对象</h3> <ul><li><p>1.ipcs命令用于查看系统中的IPC对象</p> <ul><li><ol><li><code>ipcs –m</code> 共享内存</li></ol></li> <li><ol start="2"><li><code>ipcs –s</code> 信号量</li></ol></li> <li><ol start="3"><li><code>ipcs –q</code> 消息队列</li></ol></li></ul></li> <li><p>2.ipcrm命令用于<strong>删除系统中的IPC对象</strong></p> <p><code>ipcrm –m id</code></p></li> <li><p>❗❗❗ <strong>创建的IPC对象如果不删除的话会一直保留在系统中</strong></p> <ul><li>比如：我们成功创建了一次信号集，然后要进行修改（比如我们创建的信号集里只有1个信号灯，然后我们要改为两个），那我们需要先将之前创建的信号集删除</li></ul></li></ul> <p><img src="https://jackcin877.github.io/image-hosting/Linux/ipcs-%E6%9F%A5%E7%9C%8Bipc%E5%AF%B9%E8%B1%A1.4acc95wyid60.webp" alt="ipcs-查看ipc对象"></p> <h2 id="二、共享内存"><a href="#二、共享内存" class="header-anchor">#</a> 二、共享内存</h2> <h3 id="_1-共享内存概述"><a href="#_1-共享内存概述" class="header-anchor">#</a> 1. 共享内存概述</h3> <ul><li>共享内存是一种<strong>最为高效</strong>的进程间通信方式，进程可以直接读写内存，而不需要任何数 据的拷贝</li> <li>为了在多个进程间交换信息，<strong>内核</strong>专门留出了一块内存区，可以由需要访问的进程将其 <strong>映射到自己的私有地址空间</strong></li> <li>进程就可以<strong>直接读写</strong>这一内存区而不需要进行数据的拷贝，从而大大提高的效率。</li> <li>由于多个进程共享一段内存，因此也需要依靠某种同步机制，如<strong>互斥锁</strong>和<strong>信号量</strong>等</li></ul> <h3 id="_2-共享内存实现"><a href="#_2-共享内存实现" class="header-anchor">#</a> 2. 共享内存实现</h3> <ol><li>创建/打开共享内存</li> <li>映射共享内存，即把指定的共享内存映射到进程的地址空间 用于访问</li> <li>撤销共享内存映射</li> <li>删除共享内存对象</li></ol> <h3 id="_3-共享内存函数调用流程"><a href="#_3-共享内存函数调用流程" class="header-anchor">#</a> 3.共享内存函数调用流程</h3> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.4xkhvrcpbvc0.webp" alt="共享内存函数调用流程"></p> <h3 id="_3、共享内存函数"><a href="#_3、共享内存函数" class="header-anchor">#</a> 3、共享内存函数</h3> <h4 id="_3-1-shmget"><a href="#_3-1-shmget" class="header-anchor">#</a> 3.1 shmget()</h4> <ul><li>创建/打开共享内存</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>

<span class="token operator">-</span> <span class="token keyword">int</span> <span class="token function">shmget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span>参数 
        <span class="token operator">-</span> key： IPC_PRIVATE 或 ftok的返回值
		<span class="token operator">-</span> size：共享内存区大小
		<span class="token operator">-</span> shmflg：同open函数的权限位，也可以用<span class="token number">8</span>进制表示法
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：共享内存段标识符
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-2-shmat"><a href="#_3-2-shmat" class="header-anchor">#</a> 3.2 shmat()</h4> <ul><li>将共享内存与当前进程相关联</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>
<span class="token operator">-</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">shmat</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>shmaddr<span class="token punctuation">,</span> <span class="token keyword">int</span> shmflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
		<span class="token operator">-</span> shmid：要映射的共享内存区标识符
		<span class="token operator">-</span> shmaddr：将共享内存映射到指定地址<span class="token punctuation">(</span>若为<span class="token constant">NULL</span>，则表示由系统自动完成映射<span class="token punctuation">)</span>
		<span class="token operator">-</span> shmflg <span class="token operator">:</span> 
			<span class="token operator">-</span> SHM_RDONLY：共享内存只读
			<span class="token operator">-</span> 默认<span class="token number">0</span>：共享内存可读写
	<span class="token operator">-</span> 返回值 
		<span class="token operator">-</span> 成功：映射后的地址
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_3-3-shmdt"><a href="#_3-3-shmdt" class="header-anchor">#</a> 3.3 shmdt()</h4> <ul><li>将当前进程与共享内存间脱离关联</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>
<span class="token operator">-</span> <span class="token keyword">int</span> <span class="token function">shmdt</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>shmaddr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 shmaddr：共享内存映射后的地址
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_3-4-shmctl"><a href="#_3-4-shmctl" class="header-anchor">#</a> 3.4 shmctl()</h4> <ul><li>操控共享内存</li></ul> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/shm.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">shmctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> shmid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">shmid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> shmid：要操作的共享内存标识符
        <span class="token operator">-</span> cmd <span class="token operator">:</span> 
			<span class="token operator">-</span> <span class="token function">IPC_STAT</span> <span class="token punctuation">(</span>获取对象属性<span class="token punctuation">)</span>
            <span class="token operator">-</span> <span class="token function">IPC_SET</span> <span class="token punctuation">(</span>设置对象属性<span class="token punctuation">)</span>
			<span class="token operator">-</span> <span class="token function">IPC_RMID</span> <span class="token punctuation">(</span>删除对象<span class="token punctuation">)</span>
		<span class="token operator">-</span> buf <span class="token operator">:</span> 指定IPC_STAT<span class="token operator">/</span>IPC_SET时用以保存<span class="token operator">/</span>设置属性
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_3-5-代码"><a href="#_3-5-代码" class="header-anchor">#</a> 3.5 代码</h4> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E4%BB%A3%E7%A0%81.6pztdzht1mg0.webp" alt="共享内存代码"></p> <h2 id="三、消息队列"><a href="#三、消息队列" class="header-anchor">#</a> 三、消息队列</h2> <h3 id="_1、消息队列概念"><a href="#_1、消息队列概念" class="header-anchor">#</a> 1、消息队列概念</h3> <ul><li>消息队列是IPC对象的一种</li> <li>消息队列由消息队列ID来唯一标识</li> <li>消息队列就是一个消息的列表。用户可以在消息队列中 添加消息、读取消息等。</li> <li>消息队列可以按照类型来发送/接收消息</li></ul> <h3 id="_2、消息队列模型"><a href="#_2、消息队列模型" class="header-anchor">#</a> 2、消息队列模型</h3> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B.43u3eisiy3s0.webp" alt="消息队列模型"></p> <h3 id="_3、消息队列流程"><a href="#_3、消息队列流程" class="header-anchor">#</a> 3、消息队列流程</h3> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E6%B5%81%E7%A8%8B.2qmfjhwpvue0.webp" alt="消息队列流程"></p> <h3 id="_4、消息队列函数"><a href="#_4、消息队列函数" class="header-anchor">#</a> 4、消息队列函数</h3> <h4 id="_4-1-msgget"><a href="#_4-1-msgget" class="header-anchor">#</a> 4.1 msgget()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msgget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> key：和消息队列关联的key值
		<span class="token operator">-</span> flag：消息队列的访问权限
        	<span class="token operator">-</span> IPC_CREAT ：如果消息队列对象不存在，则创建之，否则则进行打开操作<span class="token punctuation">;</span>
			<span class="token operator">-</span> IPC_EXCL：和IPC_CREAT 一起使用（用”<span class="token operator">|</span>”连接），如果消息对象不存在则创建之，否则产生一个错误并返回。
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：消息队列ID
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-2-msgsnd"><a href="#_4-2-msgsnd" class="header-anchor">#</a> 4.2 msgsnd()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msgsnd</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> msqid：消息队列的ID
		<span class="token operator">-</span> msgp：指向消息的指针。常用消息结构msgbuf如下：
        	<span class="token operator">-</span> <span class="token keyword">struct</span> <span class="token class-name">msgbuf</span><span class="token punctuation">{</span>
            	<span class="token keyword">long</span> mtype<span class="token punctuation">;</span> <span class="token comment">//消息类型</span>
            	<span class="token keyword">char</span> mtext<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token comment">//消息正文</span>
       		 	<span class="token punctuation">}</span>； 
        
		<span class="token operator">-</span> size：❗❗❗发送的消息正文的字节数
		<span class="token operator">-</span> flag： 
			<span class="token operator">-</span> IPC_NOWAIT 消息没有发送完成函数也会立即返回。
			<span class="token operator">-</span> <span class="token number">0</span>：直到发送完成函数才返回
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-3-msgrcv"><a href="#_4-3-msgrcv" class="header-anchor">#</a> 4.3 msgrcv()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msgrcv</span><span class="token punctuation">(</span><span class="token keyword">int</span> msgid<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> size<span class="token punctuation">,</span> <span class="token keyword">long</span> msgtype<span class="token punctuation">,</span> <span class="token keyword">int</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> msqid：消息队列的ID
		<span class="token operator">-</span> msgp：接收消息的缓冲区
		<span class="token operator">-</span> size：要接收的消息的字节数<span class="token punctuation">(</span>包括了消息类型和正文<span class="token punctuation">)</span>
		<span class="token operator">-</span> msgtype： 
        	<span class="token operator">-</span> <span class="token number">0</span>：接收消息队列中第一个消息。
        	<span class="token operator">-</span> 大于<span class="token number">0</span>：接收消息队列中第一个类型为msgtyp的消息<span class="token punctuation">.</span>
        	<span class="token operator">-</span> 小于<span class="token number">0</span>：接收消息队列中类型值不小于msgtyp的绝对值且类型值又最小的消息。
		<span class="token operator">-</span> flag： 
        	<span class="token operator">-</span> <span class="token number">0</span>：若无消息函数会一直阻塞
			<span class="token operator">-</span> IPC_NOWAIT：若没有消息，进程会立即返回ENOMSG。
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：接收到的消息的长度
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_4-4-msgctl"><a href="#_4-4-msgctl" class="header-anchor">#</a> 4.4 msgctl()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">msgctl</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> msgqid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">msqid_ds</span> <span class="token operator">*</span>buf <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> msqid：消息队列的队列ID
		<span class="token operator">-</span> cmd： 
        	<span class="token operator">-</span> IPC_STAT：读取消息队列的属性，并将其保存在buf指向的缓冲区中。
			<span class="token operator">-</span> IPC_SET：设置消息队列的属性。这个值取自buf参数。
			<span class="token operator">-</span> IPC_RMID：从系统中删除消息队列。
		<span class="token operator">-</span> buf：消息队列缓冲区
	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_4-5-代码"><a href="#_4-5-代码" class="header-anchor">#</a> 4.5 代码</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// msq_client.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">QUEUE_MSG_LEN</span>	<span class="token expression"><span class="token number">256</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROJ_ID</span>		<span class="token char">'g'</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PATH_NAME</span>	<span class="token string">&quot;/app&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SERVER_MSG</span>	<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CLIENT_MSG</span>	<span class="token expression"><span class="token number">2</span></span></span>
<span class="token comment">/*message data structure */</span>
<span class="token keyword">struct</span> <span class="token class-name">msg</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">long</span> type<span class="token punctuation">;</span>
	<span class="token keyword">long</span> msgtype<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> text<span class="token punctuation">[</span>QUEUE_MSG_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> qid<span class="token punctuation">;</span>
	<span class="token keyword">int</span> msglen<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">msg</span> msg_buf<span class="token punctuation">;</span>

	<span class="token comment">/* get a message queue */</span>
	<span class="token class-name">key_t</span> msgkey<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>msgkey <span class="token operator">=</span> <span class="token function">ftok</span><span class="token punctuation">(</span>PATH_NAME<span class="token punctuation">,</span> PROJ_ID<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//�õ�ID��</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;ftok error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>qid <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>msgkey<span class="token punctuation">,</span> IPC_CREAT <span class="token operator">|</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;msgget error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token comment">/*receive message from message queue with SERVER_MSG type */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgrcv</span><span class="token punctuation">(</span>qid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg_buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">msg</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SERVER_MSG<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;Server msgrcv error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;server rcv : %ld: %s\n&quot;</span><span class="token punctuation">,</span>msg_buf<span class="token punctuation">.</span>msgtype<span class="token punctuation">,</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">1</span></span></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;client send: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/*get string from terminal &amp; fill up message data structure */</span>
		<span class="token function">fgets</span><span class="token punctuation">(</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">,</span> QUEUE_MSG_LEN<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
		msg_buf<span class="token punctuation">.</span>type <span class="token operator">=</span> CLIENT_MSG<span class="token punctuation">;</span>
		msg_buf<span class="token punctuation">.</span>msgtype <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token comment">/*send message to message queue with CLIENT_MSG type */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgsnd</span><span class="token punctuation">(</span>qid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg_buf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;client msgsnd error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token punctuation">}</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// msq_server.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;sys/stat.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">QUEUE_MSG_LEN</span>	<span class="token expression"><span class="token number">256</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROJ_ID</span>		<span class="token char">'g'</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PATH_NAME</span>	<span class="token string">&quot;/app&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SERVER_MSG</span>	<span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CLIENT_MSG</span>	<span class="token expression"><span class="token number">2</span></span></span>
<span class="token comment">/*message data structure */</span>
<span class="token keyword">struct</span> <span class="token class-name">msg</span> 
<span class="token punctuation">{</span>
	<span class="token keyword">long</span> type<span class="token punctuation">;</span>
	<span class="token keyword">long</span> msgtype<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> text<span class="token punctuation">[</span>QUEUE_MSG_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/*message data structure */</span>
	<span class="token keyword">struct</span> <span class="token class-name">msg</span> msg_buf<span class="token punctuation">;</span>

	<span class="token keyword">int</span> qid<span class="token punctuation">;</span>
	<span class="token keyword">int</span> msglen<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">/*get message queue */</span>
	<span class="token class-name">key_t</span> msgkey<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>msgkey <span class="token operator">=</span> <span class="token function">ftok</span><span class="token punctuation">(</span>PATH_NAME<span class="token punctuation">,</span> PROJ_ID<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;ftok error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>qid <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>msgkey<span class="token punctuation">,</span> IPC_CREAT <span class="token operator">|</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;msgget error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;server send: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/*get string from terminal &amp; fill up message data structure */</span>
		<span class="token function">fgets</span><span class="token punctuation">(</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">,</span> QUEUE_MSG_LEN<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span> msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">msgctl</span><span class="token punctuation">(</span>qid<span class="token punctuation">,</span> IPC_RMID<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
		msg_buf<span class="token punctuation">.</span>type <span class="token operator">=</span> SERVER_MSG<span class="token punctuation">;</span>
		msg_buf<span class="token punctuation">.</span>msgtype <span class="token operator">=</span> i<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token comment">/*send message to message queue with SERVER_MSG type */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgsnd</span><span class="token punctuation">(</span>qid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg_buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">msg</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;Server msgsnd error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">1</span></span></span>
		<span class="token comment">/*receive message from message queue with CLIENT_MSG type */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">msgrcv</span><span class="token punctuation">(</span>qid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg_buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">msg</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CLIENT_MSG<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;Server msgrcv error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;server rcv: %d: %s\n&quot;</span><span class="token punctuation">,</span>msg_buf<span class="token punctuation">.</span>msgtype<span class="token punctuation">,</span>msg_buf<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>		</span>
	<span class="token punctuation">}</span>

	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><h2 id="四、信号灯-量"><a href="#四、信号灯-量" class="header-anchor">#</a> 四、信号灯/量</h2> <h3 id="_1、-临界资源"><a href="#_1、-临界资源" class="header-anchor">#</a> 1、 临界资源</h3> <ul><li><strong>一次只允许一个进程使用的资源称为临界资源；</strong> <ul><li>临界资源并不全是<code>硬件</code>或是<code>软件</code>，而是两者<strong>都能作为临界资源</strong>。</li> <li>比如硬件的有：
<ul><li>打印机、磁带机等；</li></ul></li> <li>软件有：
<ul><li>消息缓冲队列、变量、数组、缓冲区等；</li></ul></li></ul></li> <li><strong>临界区（critical region）</strong></li> <li><strong>访问共享变量的程序代码段称为临界区，也称为临界段（critical  section）</strong>;</li> <li>进程互斥
<ul><li><strong>两个或两个以上的进程不能同时进入关于同一组共享变量的临界区，否可 可能会发生与时间有关的错误，这种现象称为进程互斥；</strong></li></ul></li></ul> <h3 id="_2、信号灯"><a href="#_2、信号灯" class="header-anchor">#</a> 2、信号灯</h3> <ul><li>信号灯(semaphore)，也叫信号量。它是<strong>不同进程</strong>间或 一个给定进程内部<strong>不同线程间</strong>同步的机制。</li> <li>信号灯种类：
<ul><li>posix有名信号灯(可用于线程、进程同步)</li> <li>posix基于内存的信号灯(无名信号灯)</li> <li><strong>System V信号灯(IPC对象)</strong></li></ul></li></ul> <h3 id="_3、-system-v-信号灯"><a href="#_3、-system-v-信号灯" class="header-anchor">#</a> 3、 System V 信号灯</h3> <ul><li>System V的信号灯是一个或者多个信号灯的一个集合。 其中的每一个都是单独的计数信号灯。</li> <li>而Posix信号灯指的是单个计数信号灯</li> <li>System V 信号灯由内核维护</li></ul> <h3 id="_4、二值、计数信号灯"><a href="#_4、二值、计数信号灯" class="header-anchor">#</a> 4、二值、计数信号灯</h3> <ul><li>二值信号灯：
<ul><li>值为0或1。与互斥锁类似，资源可用时值为1，不可用时值为 0。</li></ul></li> <li>计数信号灯：
<ul><li>值在0到n之间。用来统计资源，其值代表可用资源数</li></ul></li></ul> <h3 id="_5、p-v-操作"><a href="#_5、p-v-操作" class="header-anchor">#</a> 5、P\V 操作</h3> <ul><li>通常把信号量操作抽象成PV操作
<ul><li>P ：等待操作是等待信号灯的值变为大于0，然后将其减1</li> <li>V  ：释放操作则相反，用来唤醒等待资源的进程或者线程</li></ul></li></ul> <h3 id="_6、信号灯函数"><a href="#_6、信号灯函数" class="header-anchor">#</a> 6、信号灯函数</h3> <h4 id="_6-1-semget"><a href="#_6-1-semget" class="header-anchor">#</a> 6.1 semget()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/sem.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">semget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> nsems<span class="token punctuation">,</span> <span class="token keyword">int</span> semflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
        <span class="token operator">-</span> key：和信号灯集关联的key值
		<span class="token operator">-</span> nsems<span class="token operator">:</span> 信号灯集中包含的信号灯数目
		<span class="token operator">-</span> semflg：信号灯集的访问权限，通常为IPC_CREAT <span class="token operator">|</span> <span class="token number">0666</span>
	<span class="token operator">-</span> 返回值 
    	<span class="token operator">-</span> 成功：信号灯集ID
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_6-2-semctl"><a href="#_6-2-semctl" class="header-anchor">#</a> 6.2 semctl()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/sem.h&gt;</span></span>
<span class="token operator">-</span> <span class="token keyword">int</span> <span class="token function">semctl</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> semid<span class="token punctuation">,</span> <span class="token keyword">int</span> semnum<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd…<span class="token comment">/*union semun arg*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
		<span class="token operator">-</span> semid：信号灯集ID
		<span class="token operator">-</span> semnum<span class="token operator">:</span> 要修改的信号灯编号
		<span class="token operator">-</span> cmd： 
			<span class="token operator">-</span> GETVAL：获取信号灯的值
			<span class="token operator">-</span> SETVAL：设置信号灯的值
			<span class="token operator">-</span> IPC_RMID：从系统中删除信号灯集合
            
<span class="token keyword">union</span> semun <span class="token punctuation">{</span>
	<span class="token keyword">short</span> val<span class="token punctuation">;</span> <span class="token comment">/*SETVAL用的值*/</span>
	<span class="token keyword">struct</span> <span class="token class-name">semid_ds</span><span class="token operator">*</span> buf<span class="token punctuation">;</span> <span class="token comment">/*IPC_STAT、IPC_SET用的semid_ds结构*/</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span><span class="token operator">*</span> array<span class="token punctuation">;</span> <span class="token comment">/*SETALL、GETALL用的数组值*/</span>
	<span class="token keyword">struct</span> <span class="token class-name">seminfo</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span> <span class="token comment">/*为控制IPC_INFO提供的缓存*/</span>
<span class="token punctuation">}</span> arg<span class="token punctuation">;</span>

	<span class="token operator">-</span> 返回值 
        <span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>错误原因存于errno中
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_6-3-semctl"><a href="#_6-3-semctl" class="header-anchor">#</a> 6.3 semctl()</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/sem.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">semop</span> <span class="token punctuation">(</span> <span class="token keyword">int</span> semid<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sembuf</span> <span class="token operator">*</span>opsptr<span class="token punctuation">,</span> <span class="token class-name">size_t</span> nops<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">-</span> 参数 
		<span class="token operator">-</span> semid：信号灯集ID
        <span class="token operator">-</span> <span class="token keyword">struct</span> <span class="token class-name">sembuf</span> <span class="token punctuation">{</span>
        	<span class="token keyword">short</span> sem_num<span class="token punctuation">;</span> <span class="token comment">// 要操作的信号灯的编号</span>
        	<span class="token keyword">short</span> sem_op<span class="token punctuation">;</span> <span class="token comment">// 0 : 等待，直到信号灯的值变成0</span>
        				  <span class="token comment">// 1 : 释放资源，V操作</span>
        				  <span class="token comment">// -1 : 分配资源，P操作</span>
       	 	<span class="token keyword">short</span> sem_flg<span class="token punctuation">;</span> <span class="token comment">// 0, IPC_NOWAIT, SEM_UNDO</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token operator">-</span> nops<span class="token operator">:</span> 要操作的信号灯的个数

	<span class="token operator">-</span> 返回值 
		<span class="token operator">-</span> 成功：<span class="token number">0</span>
		<span class="token operator">-</span> 出错：<span class="token operator">-</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_7、信号灯函数使用"><a href="#_7、信号灯函数使用" class="header-anchor">#</a> 7、信号灯函数使用</h3> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E4%BF%A1%E5%8F%B7%E7%81%AF%E5%87%BD%E6%95%B0%E4%BD%BF%E7%94%A8.6d3gkal1juo0.webp" alt="信号灯函数使用"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// sem.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__SEM_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__SEM_H__</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token keyword">union</span> semun <span class="token punctuation">{</span>
	<span class="token keyword">int</span>              val<span class="token punctuation">;</span>    <span class="token comment">/* Value for SETVAL */</span>
	<span class="token keyword">struct</span> <span class="token class-name">semid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">;</span>    <span class="token comment">/* Buffer for IPC_STAT, IPC_SET */</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">short</span>  <span class="token operator">*</span>array<span class="token punctuation">;</span>  <span class="token comment">/* Array for GETALL, SETALL */</span>
	<span class="token keyword">struct</span> <span class="token class-name">seminfo</span>  <span class="token operator">*</span>__buf<span class="token punctuation">;</span>  <span class="token comment">/* Buffer for IPC_INFO
								(Linux-specific) */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token keyword">int</span> <span class="token function">init_sem</span><span class="token punctuation">(</span><span class="token keyword">int</span> semid<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">int</span> val<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">union</span> semun myun<span class="token punctuation">;</span>
	myun<span class="token punctuation">.</span>val <span class="token operator">=</span> val<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">semctl</span><span class="token punctuation">(</span>semid<span class="token punctuation">,</span> num<span class="token punctuation">,</span> SETVAL<span class="token punctuation">,</span> myun<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;semctl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">sem_p</span><span class="token punctuation">(</span><span class="token keyword">int</span> semid<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">sembuf</span> mybuf<span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_num <span class="token operator">=</span> num<span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_op <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_flg <span class="token operator">=</span> SEM_UNDO<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">semop</span><span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mybuf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;semop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">sem_v</span><span class="token punctuation">(</span><span class="token keyword">int</span> semid<span class="token punctuation">,</span> <span class="token keyword">int</span> num<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">sembuf</span> mybuf<span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_num <span class="token operator">=</span> num<span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_op <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	mybuf<span class="token punctuation">.</span>sem_flg <span class="token operator">=</span> SEM_UNDO<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">semop</span><span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mybuf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;semop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// sem_client.c</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/sem.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sem.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token class-name">key_t</span> key<span class="token punctuation">;</span>   <span class="token comment">//sem key</span>
	<span class="token keyword">int</span> semid<span class="token punctuation">,</span> semval<span class="token punctuation">;</span>

	<span class="token comment">//get semaphore</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token function">ftok</span><span class="token punctuation">(</span><span class="token string">&quot;/app&quot;</span><span class="token punctuation">,</span><span class="token char">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;ftok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;key = %x\n&quot;</span><span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>semid  <span class="token operator">=</span> <span class="token function">semget</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;semget&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//get semaphore value every 1 seconds  </span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>semval <span class="token operator">=</span> <span class="token function">semctl</span><span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GETVAL<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;semctl error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>semval <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Still %d resources can be used\n&quot;</span><span class="token punctuation">,</span> semval<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> 
		<span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;No more resources can be used!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//break;</span>
		<span class="token punctuation">}</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// sem_server.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/sem.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;errno.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sem.h&quot;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_RESOURCE</span>    <span class="token expression"><span class="token number">10</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token class-name">key_t</span> key_info<span class="token punctuation">;</span>
	<span class="token keyword">int</span> semid<span class="token punctuation">;</span>

	<span class="token comment">//get semaphore </span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key_info <span class="token operator">=</span> <span class="token function">ftok</span> <span class="token punctuation">(</span><span class="token string">&quot;/app&quot;</span><span class="token punctuation">,</span> <span class="token char">'i'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span> <span class="token punctuation">(</span><span class="token string">&quot;ftok info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;key is %d\n&quot;</span><span class="token punctuation">,</span> key_info<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>semid <span class="token operator">=</span> <span class="token function">semget</span> <span class="token punctuation">(</span>key_info<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> IPC_CREAT <span class="token operator">|</span> IPC_EXCL <span class="token operator">|</span><span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">==</span> EEXIST<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			semid <span class="token operator">=</span> <span class="token function">semget</span> <span class="token punctuation">(</span>key_info<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token function">perror</span> <span class="token punctuation">(</span><span class="token string">&quot;semget&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">exit</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">init_sem</span> <span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//substract 1 every 3 seconds until semaphore value is -1</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{</span>
		<span class="token comment">//p</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;p\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sem_p</span> <span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//进入临界区</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//V</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;v\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sem_v</span> <span class="token punctuation">(</span>semid<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="_8、信号量与共享内存"><a href="#_8、信号量与共享内存" class="header-anchor">#</a> 8、信号量与共享内存</h3> <p><img src="https://jackcin877.github.io/image-hosting/Linux/%E4%BF%A1%E5%8F%B7%E9%87%8F%E4%B8%8E%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98.kfu68rrnkxs.webp" alt="信号量与共享内存"></p> <h2 id="五、进程间通信方式比较"><a href="#五、进程间通信方式比较" class="header-anchor">#</a> 五、进程间通信方式比较</h2> <table><thead><tr><th>通信方式</th> <th>特点</th></tr></thead> <tbody><tr><td>signal 信号捕捉</td> <td>唯一的异步通信方式</td></tr> <tr><td>msg 消息队列</td> <td>常用于cs模式中， 按<strong>消息类型访问</strong> ，<strong>可有优先级</strong></td></tr> <tr><td>shm 共享内存</td> <td><strong>效率最高(直接访问内存)</strong> ，需要同步、互斥机制</td></tr> <tr><td>sem 信号灯/量</td> <td><strong>配合共享内存使用</strong>，用以实现同步和互斥</td></tr> <tr><td>pipe 匿名管道</td> <td>具有亲缘关系的进程间，单工，数据在内存中</td></tr> <tr><td>fifo  有名管道</td> <td>可用于任意进程间，双工，有文件名，数据在内存</td></tr></tbody></table></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/JackCin877/vuepress-theme-vdoing/edit/master/docs/03.Linux/20.Linux 多进程开发/06.进程间通信补充.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/09/13, 12:29:52</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/vuepress-theme-vdoing/pages/3fe48e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">进程间通信</div></a> <a href="/vuepress-theme-vdoing/pages/fbb788/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">信号</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/vuepress-theme-vdoing/pages/3fe48e/" class="prev">进程间通信</a></span> <span class="next"><a href="/vuepress-theme-vdoing/pages/fbb788/">信号</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/vuepress-theme-vdoing/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/vuepress-theme-vdoing/pages/188689/"><div>
            51单片机及补充知识
            <!----></div></a> <span class="date">09-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/vuepress-theme-vdoing/pages/b10f7a/"><div>
            独立按键
            <!----></div></a> <span class="date">09-13</span></dt></dl><dl><dd>03</dd> <dt><a href="/vuepress-theme-vdoing/pages/b4d59b/"><div>
            LCD1602液晶显示器
            <!----></div></a> <span class="date">09-13</span></dt></dl> <dl><dd></dd> <dt><a href="/vuepress-theme-vdoing/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2269233033@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/JackCin877" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/vuepress-theme-vdoing/assets/js/app.ef19247d.js" defer></script><script src="/vuepress-theme-vdoing/assets/js/2.59d30681.js" defer></script><script src="/vuepress-theme-vdoing/assets/js/64.25da2825.js" defer></script>
  </body>
</html>
