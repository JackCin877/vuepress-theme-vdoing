---
title: æ–‡ä»¶IO
date: 2023-09-12 17:03:37
permalink: /pages/a358ad/
categories:
  - Linux
  - Linuxç³»ç»Ÿç¼–ç¨‹å…¥é—¨
tags:
  - 
author: 
  name: JackCin
  link: https://github.com/JackCin877
---
# æ–‡ä»¶ I/O

* **æˆ‘ä»¬çš„IOæ˜¯ç«™åœ¨å†…å­˜çš„è§’åº¦å»çœ‹å¾…çš„**, è¾“å…¥( I )å°±æ˜¯ä»æ–‡ä»¶é‡Œé¢æŠŠæ•°æ®è¯»å–åˆ°å†…å­˜ï¼Œè¾“å‡º( O )å°±æ˜¯ä»å†…å­˜é‡Œé¢æŠŠæ•°æ®å†™å…¥åˆ°æ–‡ä»¶

### 1ã€æ ‡å‡†Cåº“ IOå‡½æ•°

![Oå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/æ ‡å‡†cåº“-I/Oå‡½æ•°.2mbn9h86oqy0.webp)

* **æ ‡å‡†cåº“çš„ IO å‡½æ•°æœ‰è·¨å¹³å°æ€§**,å³æˆ‘ä»¬ç”¨æ ‡å‡†cåº“å¼€å‘çš„ç¨‹åºå†ä¸ªä¸ªå¹³å°(æ“ä½œç³»ç»Ÿ)éƒ½å¯ä»¥è¿è¡Œ
* æ ‡å‡†cåº“AKAç¬¬ä¸‰æ–¹åº“,å®ƒæ˜¯ä¸å±äºæ“ä½œç³»ç»Ÿçš„,å®ƒä¹‹æ‰€ä»¥èƒ½å®ç°è·¨å¹³å°æ˜¯å› ä¸ºä»–åœ¨ä¸åŒå¹³å°ä¼šè°ƒç”¨ä¸åŒå¹³å°çš„ç³»ç»Ÿ api

* **ç¼“å†²åŒº**å¤§å°é»˜è®¤æ˜¯ 8k (å¯è°ƒèŠ‚,ä½†ä¸å»ºè®®) 

### 2ã€æ ‡å‡†cåº“IOå’ŒLinuxç³»ç»ŸIOçš„å…³ç³»

![æ ‡å‡†cåº“-IOå’Œ-Linuxç³»ç»ŸIOçš„å…³ç³»](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/æ ‡å‡†cåº“-IOå’Œ-Linuxç³»ç»ŸIOçš„å…³ç³».29uneuf8f0n4.webp)

### 3ã€è™šæ‹Ÿåœ°å€ç©ºé—´

![è™šæ‹Ÿåœ°å€ç©ºé—´](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/è™šæ‹Ÿåœ°å€ç©ºé—´.76v1kq086v80.webp)



* **å¯æ‰§è¡Œç¨‹åºè¿è¡ŒæœŸé—´å°±ä¼šå¯¹åº”ä¸€ä¸ªè™šæ‹Ÿå†…å­˜ç©ºé—´**,ç¨‹åºè¿è¡Œç»“æŸç©ºé—´å°±ä¸å­˜åœ¨äº†
* **è¿›ç¨‹æ˜¯ç³»ç»Ÿç»™ç¨‹åºåˆ†é…èµ„æºçš„æœ€å°å•ä½**
* 32ä½çš„è®¡ç®—æœºè™šæ‹Ÿåœ°å€ç©ºé—´å¤§å°å°±æ˜¯2^32(4G),æˆ‘ä»¬ä¸Šå›¾å°±Sæ˜¯32ä½çš„
  * 64ä½ç”µè„‘å¹¶ä¸æ˜¯ 2^64 ä½,è€Œæ˜¯ 2^48
* linux kernel(Linux å†…æ ¸åŒº) æ™®é€šç”¨æˆ·æ²¡æœ‰æƒé™æ“ä½œ,è¦æƒ³æ“ä½œå†…æ ¸åŒºå¿…é¡»è°ƒç”¨ç³»ç»Ÿçš„API,é€šè¿‡ç³»ç»Ÿ APIå‡½æ•°(å¦‚ read ,write)æ¥è¿›è¡Œæ“ä½œ

![è™šæ‹Ÿåœ°å€ç©ºé—´](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/è™šæ‹Ÿåœ°å€ç©ºé—´.6q35wr2qky00.webp)

- **å…¨å±€å˜é‡**ï¼šä¿å­˜åœ¨å†…å­˜çš„å…¨å±€å­˜å‚¨åŒºä¸­ï¼Œå ç”¨é™æ€çš„å­˜å‚¨å•å…ƒ
- **å±€éƒ¨å˜é‡**ï¼šä¿å­˜åœ¨æ ˆä¸­ï¼Œåªæœ‰åœ¨æ‰€åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶æ‰åŠ¨æ€åœ°ä¸ºå˜é‡åˆ†é…å­˜å‚¨å•å…ƒ

### 4ã€æ–‡ä»¶æè¿°ç¬¦

![æ–‡ä»¶æè¿°ç¬¦](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/æ–‡ä»¶æè¿°ç¬¦.3iy4hsr6uh00.webp)

* **æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¿å­˜åœ¨å†…æ ¸åŒº**,ç”±å†…æ ¸è¿›è¡Œç®¡ç†
  * å†…æ ¸æœ‰å†…å­˜ç®¡ç†çš„åŠŸèƒ½,åœ¨å†…æ ¸çš„å†…å­˜ç®¡ç†æ¨¡å—é‡Œæœ‰**PCBè¿›ç¨‹æ§åˆ¶å—**,ç”±å®ƒæ¥ç®¡ç†æ–‡ä»¶æè¿°ç¬¦
  * PCB æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç»“æ„ä½“,åœ¨è¿™ä¸ªç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ª**æ•°ç»„(æ–‡ä»¶æè¿°ç¬¦è¡¨)**,ä¹‹æ‰€ä»¥éœ€è¦è¿™ä¸ªè¡¨æ˜¯å› ä¸ºæˆ‘ä»¬å¯èƒ½ä¼šåŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶,é‚£å°±ä¼šæœ‰å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦
    * æ–‡ä»¶æè¿°ç¬¦è¡¨çš„å¤§å°é»˜è®¤æ˜¯ 1024
  * **æ–‡ä»¶æè¿°ç¬¦è¡¨çš„å‰ä¸‰ä¸ªé»˜è®¤æ˜¯è¢«å ç”¨çš„**(å¦‚ä¸Šå›¾),æ ‡å‡†è¾“å…¥(0),æ ‡å‡†è¾“å‡º(1),æ ‡å‡†é”™è¯¯(2),**ä»–ä»¬æŒ‡å‘çš„æ˜¯å½“å‰çš„ç»ˆç«¯**
  * æ³¨æ„: â€œæ¯æ‰“å¼€...æè¿°ç¬¦â€ è¿™æ®µè¯çš„æ„æ€æ˜¯,å¥½æ¯”æˆ‘ä»¬æœ‰3ä¸ªæ–‡ä»¶æè¿°ç¬¦,é‚£å°±æ˜¯ä»3å¼€å§‹å ç”¨æ–‡ä»¶æè¿°ç¬¦è¡¨çš„ç©ºé—´( å³3,4,5 ),å½“3å·ç©ºé—´çš„æ–‡ä»¶æè¿°ç¬¦è¢«é‡Šæ”¾,é‚£é‡æ–°äº§ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯è¿›åˆ°3é‡Œ,è€Œä¸æ˜¯å­˜æ”¾åˆ°6é‡Œ

### 5ã€Linux ç³»ç»Ÿ IO å‡½æ•°

#### 5.1 openæ‰“å¼€æ–‡ä»¶

> * int open(const char *pathname, int flags);

* ä½¿ç”¨ `man 2 open` æŸ¥çœ‹ openå‡½æ•°

```c
/*
    #include <sys/types.h>
    #include <sys/stat.h>
    #include <fcntl.h>

    //æ‰“å¼€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶
    int open(const char *pathname, int flags);
        å‚æ•°ï¼š
            - pathname ï¼š è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„
            - flagsï¼š å¯¹æ–‡ä»¶çš„æ“ä½œæƒé™è®¾ç½®è¿˜æœ‰å…¶ä»–çš„è®¾ç½®
            O_RDONLYï¼ˆå¯è¯»ï¼‰, O_WRONLYï¼ˆå¯å†™ï¼‰, O_RDWRï¼ˆå¯è¯»å¯å†™ï¼‰  è¿™3ä¸ªæ˜¯äº’æ–¥çš„

        è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè¿”å› -1

    errnoï¼šå±äºLinuxç³»ç»Ÿå‡½æ•°åº“ï¼Œåº“é‡Œé¢çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œè®°å½•çš„æ˜¯æœ€è¿‘çš„é”™è¯¯å·ã€‚

    #include <stdio.h>
    void perror(const char *s); ä½œç”¨ï¼šæ‰“å°errorå¯¹åº”çš„é”™è¯¯æè¿°
        så‚æ•°ï¼šç”¨æˆ·æè¿°ï¼Œæ¯”å¦‚helloï¼Œæœ€ç»ˆè¾“å‡ºçš„å†…å®¹æ˜¯ hello:xxx(å®é™…çš„é”™è¯¯æè¿°)

*/
```



```c
// open.c ,æ­¤æ—¶æˆ‘ä»¬å½“å‰æ–‡ä»¶å¤¹é‡Œæ²¡æœ‰a.txtæ–‡ä»¶
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdio.h>   //perror
#include <unistd.h>  //close

int main()
{
    //æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶
    int fd = open("a.txt", O_RDONLY);

    if (fd == -1)
    {
        perror("open");
    }

    // å…³é—­fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æŒ‡å‘çš„æ–‡ä»¶
    //closeå°±æ˜¯æ ¹æ®æ–‡ä»¶æè¿°ç¬¦å…³é—­å…¶æŒ‡å‘çš„æ–‡ä»¶
    close(fd);

    return 0;
}
```

* `gcc open.c -o open` ç”Ÿæˆ å¯æ‰§è¡Œæ–‡ä»¶ **open**
* æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ `./open`

```c
//æ­¤æ—¶æˆ‘ä»¬å½“å‰æ–‡ä»¶å¤¹é‡Œæ²¡æœ‰a.txtæ–‡ä»¶,é‚£ä¹ˆå®ƒå°±æ˜¾ç¤ºæ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•
open: No such file or directory
```

#### 5.2 openåˆ›å»ºæ–°æ–‡ä»¶

> *  int open(const char *pathname, int flags, mode_t mode);

```c
    #include <sys/types.h>
    #include <sys/stat.h>
    #include <fcntl.h>

    int open(const char *pathname, int flags, mode_t mode);
        å‚æ•°ï¼š
            - pathnameï¼šè¦åˆ›å»ºçš„æ–‡ä»¶çš„è·¯å¾„
            - flagsï¼š å¯¹æ–‡ä»¶çš„æ“ä½œæƒé™è®¾ç½®è¿˜æœ‰å…¶ä»–çš„è®¾ç½®
                -å¿…é€‰é¡¹ï¼š O_RDONLYï¼ˆå¯è¯»ï¼‰, O_WRONLYï¼ˆå¯å†™ï¼‰, O_RDWRï¼ˆå¯è¯»å¯å†™ï¼‰  è¿™3ä¸ªæ˜¯äº’æ–¥çš„
                -å¯é€‰é¡¹ï¼š  O_CREAT æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶
                
            - modeï¼šå…«è¿›åˆ¶çš„æ•°ï¼Œè¡¨ç¤ºåˆ›å»ºå‡ºæ¥çš„æ–°æ–‡ä»¶çš„æ“ä½œæƒé™ æ¯”å¦‚ï¼š0775
                0777-> rwxrwxrwx , rw-rw-r--  => 0664
                å•ç‹¬æ‹¿ä¸€ç»„å‡ºæ¥è§£é‡Šä¸€ä¸‹ï¼š rwx -ã€‹2^2 + 2^1 + 2^1 = 7

                æœ€ç»ˆçš„æƒé™æ˜¯ï¼šmode & ~umask(æƒé™æ©ç ï¼Œæ™®é€šç”¨æˆ·çš„é»˜è®¤çš„umaskæ˜¯0002ï¼Œrootæ˜¯0022)
                æ¯”å¦‚ï¼š æˆ‘ä»¬ç»™mode ä¸º 0777 é‚£ä¹ˆæœ€ç»ˆçš„æƒé™å°±æ˜¯ï¼š0775
                ~umask : 0002å–åï¼ˆå…«è¿›åˆ¶ï¼‰é‚£å°±æ˜¯ 111 111 101 -ã€‹0775
                æœ€ç»ˆæƒé™ï¼š
                        0777  â€”â€”>  111111111
                    &   0775  â€”â€”>  111111101
                    -----------------------------
                                   111111101
                æŒ‰ä½ä¸ï¼š 0å’Œä»»ä½•æ•°éƒ½ä¸º0 ï¼Œumaskçš„ä½œç”¨å°±ç®—æŠ¹å»æŸäº›æƒé™

```

*  **flags å‚æ•°æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°æ®ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œ32ä½ã€‚**
  * **flags 32ä¸ªä½ï¼Œæ¯ä¸€ä½å°±æ˜¯ä¸€ä¸ªæ ‡å¿—ä½ã€‚**
* **è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†™falgsçš„å‚æ•°æ—¶ç”¨ |[æŒ‰ä½æˆ–] çš„åŸå› **ï¼Œå°±å¥½æ¯”è¯´32ä½é‡Œæ¯ä¸€ä½éƒ½ä»£è¡¨ä¸€ä¸ªæƒé™ï¼Œä¸”éƒ½ä¸º0ï¼Œç„¶åO_RDONLYæ˜¯000ã€‚ã€‚ã€‚1ï¼Œé‚£æˆ‘ä»¬å°±ç”¨ | å°†flagsçš„ç¬¬ä¸€ä½ç½®ä¸º1ï¼Œè¿™é‡Œåªæ˜¯æ‰“ä¸ªæ¯”æ–¹ï¼Œä¸æ˜¯è¯´O_RDONLYå°±ç¬¬ä¸€ä½

```c
// create.c
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>

int main()
{   //ä¸‹é¢è¡Œçš„æƒé™å¿…é¡»å†™å››ä½çš„æ•°ï¼Œå¦‚ 0777è€Œä¸èƒ½å†™ 777(è¿™æ ·å†™çš„è¯æ˜¯10è¿›åˆ¶æ•°)
    int fd = open("create.txt", O_RDWR | O_CREAT, 0777);
    
    if (fd == -1)
    {
        perror("open");
    }

    // å…³é—­
    close(fd);

    return 0;
}
```

![openæ‰“å¼€æ–°æ–‡ä»¶](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/openæ‰“å¼€æ–°æ–‡ä»¶.ybqmsf1v4tc.webp)

* å¯ä»¥çœ‹å‡º, `create.txt`  çš„æƒé™ä¸º 0775 
* **æƒé™æ©ç  umask:** 
  * æŸ¥çœ‹æŒ‡ä»¤: `umask`
  * ä¿®æ”¹æŒ‡ä»¤: `umask æƒ³è¦æ”¹æˆçš„æƒé™`  å¦‚  `umask 022`  ,è¿™ç§ä¿®æ”¹æ–¹å¼å…³é—­ç»ˆç«¯å°±ä¼šè¢«è¿˜åŸ
  * ä¹Ÿå¯ä»¥ä½¿ç”¨ umask()å‡½æ•°åœ¨ç¨‹åºä¸­è®¾ç½®è¿™ä¸ªå€¼  
    * `man 2 umask`,æŸ¥çœ‹umask()å‡½æ•°



#### 5.3 read , writeå‡½æ•°

> * ssize_t read(int fd, void *buf, size_t count); 
> * ssize_t write(int fd, const void *buf, size_t count); 

```c

    #include <unistd.h>
    ssize_t read(int fd, void *buf, size_t count);
        å‚æ•°ï¼š
            - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopenå¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
            - bufï¼šéœ€è¦è¯»å–æ•°æ®å­˜æ”¾çš„åœ°æ–¹ï¼Œæ•°ç»„çš„åœ°å€ ï¼ˆä¼ å‡ºå‚æ•°ï¼‰
            - countï¼šæŒ‡å®šçš„æ•°ç»„çš„å¤§å°
        è¿”å›å€¼ï¼š
            - æˆåŠŸï¼š
                >0 :è¿”å›å®é™…çš„è¯»å–åˆ°å¾—å­—èŠ‚æ•°
                =0 : æ–‡ä»¶å·²ç»è¯»å–å®Œäº†
            - å¤±è´¥ï¼š-1ï¼Œå¹¶ä¸”è®¾ç½®errno

    #include <unistd.h>
    ssize_t write(int fd, const void *buf, size_t count);
        å‚æ•°ï¼š
            - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œopenå¾—åˆ°çš„ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æ“ä½œæŸä¸ªæ–‡ä»¶
            - bufï¼šè¦å¾€ç£ç›˜å†™å…¥çš„æ•°æ®ï¼Œæ•°æ®
            - countï¼šè¦å†™å…¥çš„æ•°æ®çš„å®é™…çš„å¤§å°
        è¿”å›å€¼ï¼š
            æˆåŠŸï¼šå®é™…å†™å…¥çš„å­—èŠ‚æ•°
            å¤±è´¥ï¼šæ”¾å›-1ï¼Œå¹¶è®¾ç½® errno
```

```c
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>

int main()
{

    // 1.é€šè¿‡openæ‰“å¼€english.txtæ–‡ä»¶
    int srcfd = open("english.txt", O_RDONLY);
    if (srcfd == -1)
    {
        perror("open");
        return -1;
    }

    // 2.åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ ï¼ˆæ‹·è´æ–‡ä»¶ï¼‰
    int destfd = open("cpy.txt", O_WRONLY | O_CREAT, 0664);
    if (destfd == -1)
    {
        perror("open");
        return -1;
    }

    // 3ï¼Œé¢‘ç¹çš„è¯»å†™æ“ä½œ
    // bufçš„å¤§å°æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¾ç½®
    char buf[1024] = {0};
    // æˆ‘ä»¬è¿™é‡Œè®¾ç½®äº†1024ï¼Œé‚£ä¹ˆæ¯æ¬¡è¯»å–åº”è¯¥å°±æ˜¯1024ï¼Œåªæœ‰æœ€åä¸€æ¬¡è¯»å–ä¸ä¸€æ ·å¯èƒ½ä¼šå°äº1024

    int len = 0;
    // å¾—åˆ°å®é™…çš„è¯»å–åˆ°å¾—å­—èŠ‚æ•°ï¼Œå¤§äº0è¯´æ˜è¿˜æ²¡è¯»å®Œ
    while ((len = read(srcfd, buf, sizeof(buf))) > 0)
    {
        write(destfd, buf, len);
    }

    // 4.å…³é—­æ–‡ä»¶
    close(destfd);
    close(srcfd);
}
```

![readï¼Œwriteå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/readï¼Œwriteå‡½æ•°.4805j1ruik80.webp)

#### 5.4ã€lseekå‡½æ•°

> * off_t lseek(int fd, off_t offset, int whence);

```c
//æ ‡å¿—Cåº“çš„å‡½æ•°
#include <stdio.h>
int fseek(FILE *stream, long offset, int whence);
//Linuxç³»ç»Ÿå‡½æ•°
#include <sys/types.h>
#include <unistd.h>
off_t lseek(int fd, off_t offset, int whence);
    - å‚æ•°ï¼š
         - fdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡ open å¾—åˆ°ï¼Œé€šè¿‡è¿™ä¸ª fdæ“ä½œæŸä¸ªæ–‡ä»¶
         - offsetï¼šåç§»é‡
         - whenceï¼š
            SEEK_SET ï¼ˆæ–‡ä»¶å¼€å¤´ï¼‰
                è®¾ç½®æ–‡ä»¶æŒ‡é’ˆçš„åç§»é‡
            SEEK_CUR
                è®¾ç½®åç§»é‡ï¼šå½“å‰ä½ç½® + ç¬¬äºŒä¸ªå‚æ•° offsetçš„å€¼
            SEEK_END ï¼ˆæ–‡ä»¶çš„æœ«å°¾ï¼‰
                è®¾ç½®åç§»é‡: æ–‡ä»¶å¤§å° + ç¬¬äºŒä¸ªå‚æ•°offsetçš„å€¼
    - è¿”å›å€¼ï¼š è¿”å›æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®
ä½œç”¨ï¼š
    1.ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æ–‡ä»¶å¤´
        lseek(fd, 0, SEEK_SET);
    2.è·å–å½“å‰æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®
        lseek(fd, 0, SEEK_CUR);
    3.è·å–æ–‡ä»¶é•¿åº¦
        lseek(fd, 0, SEEK_END);
    4.æ‹“å±•æ–‡ä»¶çš„é•¿åº¦ï¼Œå½“å‰æ–‡ä»¶10bï¼Œ110bï¼Œå¢åŠ äº† 100ä¸ªå­—èŠ‚
        lseek(fd, 100, SEEK_END);
    æ³¨æ„ï¼šéœ€è¦å†™ä¸€æ¬¡æ•°æ®
        (æ‹“å±•çš„ä½œç”¨ï¼šå¥½æ¯”æˆ‘ä»¬è¦ä¸‹è½½ä¸œè¥¿ï¼Œéœ€è¦5G,æˆ‘ä»¬å¯ä»¥å…ˆæ‹“å±•å‡º5Gçš„å¤§å°ï¼Œç„¶åå†ç»§ç»­ä¸‹è½½ï¼Œè¿™æ ·å³ä½¿æˆ‘ä»¬ç»§ç»­ä½¿ç”¨ç£ç›˜ä¹Ÿä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºæˆ‘ä»¬5Gçš„ç©ºé—´å·²ç»å ç”¨äº†)

```

```c
//lseek.c
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>

int main()
{
    // æ‰“å¼€æ–‡ä»¶
    int fd = open("hello.txt", O_RDWR);

    if (fd == -1)
    {
        perror("open");
    }

    // æ‹“å±•æ–‡ä»¶çš„é•¿åº¦
    int ret = lseek(fd, 100, SEEK_END);
    if (ret == -1)
    {
        perror("lseek");
    }

    // å†™å…¥ä¸€ä¸ªç©ºæ•°æ®
    write(fd, " ", 1);

    // å…³é—­æ–‡ä»¶
    close(fd);
    return 0;
}
```

![lseekå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/lseekå‡½æ•°.2mo1w99w3j20.webp)

* ä¸Šå›¾ç¬¬ä¸€æ¬¡ç¼–è¯‘ç”Ÿæˆå¹¶è¿è¡Œ lseekæ–‡ä»¶åï¼Œhello.txt æ–‡ä»¶å¤§å°æ²¡å˜åŒ–ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æ²¡åœ¨æ‹“å±•æ–‡ä»¶åå†™è¿›ä¸œè¥¿
* ç¬¬äºŒæ¬¡æˆåŠŸæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ‹“å±•åï¼Œå†™å…¥ä¸€ä¸ªç©ºæ•°æ® ` write(fd, " ", 1);`ï¼Œå®Œæ•´ä»£ç çœ‹ä¸Šå›¾
* **è€Œåœ¨æ‰©å±•å‡ºæ¥çš„è¿™æ®µç©ºé—´é‡Œï¼Œæ¯ä¸€ä½éƒ½ä¼šè¢« null å¡«å……**
* æ³¨æ„ï¼š**lseek()ä¸æ˜¯æ‰©å±•æ•°æ®çš„åŠŸèƒ½ï¼Œåªæ˜¯å¯ä»¥åˆ©ç”¨lseek()å»æ‰©å±•æ–‡ä»¶ï¼Œlseek()åªæ˜¯å•çº¯çš„ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåç§»**ã€‚

#### 5.5 statã€lstatå‡½æ•°

> *  int stat(const char *pathname, struct stat *statbuf);
> *  int lstat(const char *pathname, struct stat *statbuf);

```c
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
int stat(const char *pathname, struct stat *statbuf);
    ä½œç”¨ï¼šè·å–ä¸€ä¸ªæ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯
    å‚æ•°ï¼š
        - pathname: æ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
        - statbufï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
    è¿”å›å€¼ï¼š
        æˆåŠŸï¼šè¿”å›0
        å¤±è´¥ï¼šè¿”å›-1 è®¾ç½®errno
```

```c
//stat ç»“æ„ä½“

struct stat {
	dev_t st_dev;  // æ–‡ä»¶çš„è®¾å¤‡ç¼–å·
	ino_t st_ino;  // èŠ‚ç‚¹
	mode_t st_mode;  // æ–‡ä»¶çš„ç±»å‹å’Œå­˜å–çš„æƒé™
	nlink_t st_nlink;  // è¿åˆ°è¯¥æ–‡ä»¶çš„ç¡¬è¿æ¥æ•°ç›®
	uid_t st_uid;  // ç”¨æˆ·ID
	gid_t st_gid;  // ç»„ID
	dev_t st_rdev;  // è®¾å¤‡æ–‡ä»¶çš„è®¾å¤‡ç¼–å·
	off_t st_size;  // æ–‡ä»¶å­—èŠ‚æ•°(æ–‡ä»¶å¤§å°)
	blksize_t st_blksize;  // å—å¤§å°
	blkcnt_t st_blocks;  // å—æ•°
	time_t st_atime;  // æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´
	time_t st_mtime;  // æœ€åä¸€æ¬¡ä¿®æ”¹æ—¶é—´
	time_t st_ctime;  // æœ€åä¸€æ¬¡æ”¹å˜æ—¶é—´(æŒ‡å±æ€§)
};
```



```c
//a.txt
hello,world
    
//stat.c
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include <stdio.h>

int main()
{
    struct stat statbuf;
    int ret = stat("a.txt", &statbuf);
    
    if (ret == -1)
    {
        perror("stat");
        return -1;
    }
    printf("size: %ld\n", statbuf.st_size);

    return 0;
}
```

![statå‡½æ•°ä¸å‘½ä»¤](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/statå‡½æ•°ä¸å‘½ä»¤.5378faflw0c0.webp)

* æŸ¥çœ‹æ–‡ä»¶ç›¸å…³ä¿¡æ¯ç”±ä¸¤ç§æ–¹æ³•
  * 1. ç»ˆç«¯å‘½ä»¤æŸ¥çœ‹ å¦‚ï¼š`stat æ–‡ä»¶è·¯å¾„`
    2. `stat()` å‡½æ•°

```c
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
int lstat(const char *pathname, struct stat *statbuf);
    ä½œç”¨ï¼šè·å–ä¸€ä¸ªæ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯(è·å–è½¯è¿æ¥æ–‡ä»¶çš„ä¿¡æ¯)
    å‚æ•°ï¼š
        - pathname: æ“ä½œçš„æ–‡ä»¶çš„è·¯å¾„
        - statbufï¼šç»“æ„ä½“å˜é‡ï¼Œä¼ å‡ºå‚æ•°ï¼Œç”¨äºä¿å­˜è·å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
    è¿”å›å€¼ï¼š
        æˆåŠŸï¼šè¿”å›0
        å¤±è´¥ï¼šè¿”å›-1 è®¾ç½®errno
```

![è½¯é“¾æ¥](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/è½¯é“¾æ¥.71oqzu1bbx00.webp)

* `ln -s a.txt b.txt` åˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶ `b.txt` æŒ‡å‘ `a.txt`
* å¦‚æœæˆ‘ä»¬ç”¨stat()å‡½æ•°æŸ¥çœ‹,é‚£æˆ‘ä»¬æŸ¥çœ‹çš„å°±æ˜¯ a.txt æ–‡ä»¶ï¼Œæ‰€ä»¥è¦æƒ³æŸ¥çœ‹è½¯é“¾æ¥æ–‡ä»¶ï¼Œå¿…é¡»ä½¿ç”¨ lstat()å‡½æ•°

```c
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include <stdio.h>

int main()
{

    struct stat statbuf;
	//è¿™é‡ŒæŸ¥çœ‹çš„æ˜¯b.txt(è½¯é“¾æ¥)ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ lstat()å‡½æ•°
    int ret = lstat("b.txt", &statbuf);

    if (ret == -1)
    {
        perror("stat");
        return -1;
    }

    printf("size: %ld\n", statbuf.st_size);
    printf("ino: %ld\n", statbuf.st_ino);
    printf("dev: %ld\n", statbuf.st_dev);

    return 0;
}
```



### 6ã€statç»“æ„ä½“

![statç»“æ„ä½“](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/statç»“æ„ä½“.7du10ydybto0.webp)



### 7ã€st_modeå˜é‡

![st_mode-å˜é‡](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/st_mode-å˜é‡.anqb38ie8zc.webp)

### 8ã€æ¨¡æ‹Ÿå®ç° ls -l å‘½ä»¤

```c
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <unistd.h>
#include <pwd.h>
#include <grp.h>
#include <time.h>
#include <string.h>

// æ¨¡æ‹Ÿå®ç° ls -l æŒ‡ä»¤
// -rw-rw-r-- 1 nowcoder nowcoder 12 4æœˆ  12 14:43 a.txt

int main(int argc, char *argv[])
{

    // å› ä¸ºæˆ‘ä»¬çš„å‚æ•°æ•°ç»„ argv é»˜è®¤ä¼šæœ‰ä¸€ä¸ªæ•°æ®ä¸ºæˆ‘ä»¬å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å
    // æ‰€ä»¥ argc ï¼ˆå‚æ•°æ•°é‡ï¼‰<2 ,è¯´æ˜æ²¡ç»™å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åˆ¤æ–­è¾“å…¥çš„å‚æ•°æ˜¯å¦æ­£ç¡®
    if (argc < 2)
    {
        // ä¸æ­£ç¡®ï¼Œç»™å‡ºæç¤º
        printf("%s filename\n", argv[0]);
        return -1;
    }

    // é€šè¿‡statå‡½æ•°è·å–ç”¨æˆ·ä¼ å…¥çš„æ–‡ä»¶çš„ä¿¡æ¯
    struct stat st;
    int ret = stat(argv[1], &st);
    if (ret == -1)
    {
        perror("stat");
        return -1;
    }

    // è·å–æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶æƒé™
    char perms[11] = {0}; // ç”¨äºä¿å­˜æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶æƒé™çš„å­—ç¬¦ä¸²

    // è·å¾—çš„æ–‡ä»¶æƒé™å’Œæƒé™æ©ç è¿›è¡Œä¸è¿ç®—ï¼Œåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹çš„æ–‡ä»¶
    //æ³¨æ„åœ¨æˆ‘è‡ªå·±çš„vscodeé‡Œå†™ä¸‹é¢ä»£ç æ—¶ï¼Œ åƒS_IFMTè¿™äº›ä¼šæ˜¾ç¤ºè¯´æ˜¯æœªå®šä¹‰æ ‡è¯†ç¬¦ï¼Œè¦å†™__S_IFMTæ‰æ­£å¸¸ï¼Œè¿™åº”è¯¥æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥		S_IFMTè¿™æ ·å†™ï¼Œåœ¨gccé‡Œæ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œçš„
    switch (st.st_mode & S_IFMT)
    {
    case S_IFLNK:
        perms[0] = 'l';
        break;
    case S_IFDIR:
        perms[0] = 'd';
        break;
    case S_IFREG:
        perms[0] = '-';
        break;
    case S_IFBLK:
        perms[0] = 'b';
        break;
    case S_IFCHR:
        perms[0] = 'c';
        break;
    case S_IFSOCK:
        perms[0] = 's';
        break;
    case S_IFIFO:
        perms[0] = 'p';
        break;
    default:
        perms[0] = '?';
        break;
    }

    // åˆ¤æ–­æ–‡ä»¶çš„è®¿é—®æƒé™

    // æ–‡ä»¶æ‰€æœ‰è€…
    // æŒ‰ä½ä¸ï¼Œé‡0ä¸º0.åŒ1ä¸º1
    perms[1] = (st.st_mode & S_IRUSR) ? 'r' : '-';
    perms[2] = (st.st_mode & S_IWUSR) ? 'w' : '-';
    perms[3] = (st.st_mode & S_IXUSR) ? 'x' : '-';

    // æ–‡ä»¶æ‰€åœ¨ç»„
    perms[4] = (st.st_mode & S_IRGRP) ? 'r' : '-';
    perms[5] = (st.st_mode & S_IWGRP) ? 'w' : '-';
    perms[6] = (st.st_mode & S_IXGRP) ? 'x' : '-';

    // å…¶ä»–äºº
    perms[7] = (st.st_mode & S_IROTH) ? 'r' : '-';
    perms[8] = (st.st_mode & S_IWOTH) ? 'w' : '-';
    perms[9] = (st.st_mode & S_IXOTH) ? 'x' : '-';

    // ç¡¬è¿æ¥æ•°
    int linkNum = st.st_nlink;

    // æ–‡ä»¶æ‰€æœ‰è€…
    // å› ä¸º st.st_uid è·å¾—çš„æ˜¯ä¸€ä¸ªidå·ï¼Œä½†æˆ‘ä»¬æ¨¡æ‹Ÿ ls -l æŒ‡ä»¤è·å¾—çš„æ˜¯ç”¨æˆ·å
    // æ‰€ä»¥æˆ‘ä»¬éœ€è¦ pwd åº“é‡Œçš„ getpwuid() å‡½æ•°
    char *fileUser = getpwuid(st.st_uid)->pw_name;

    // æ–‡ä»¶æ‰€åœ¨ç»„
    // åŒä¸Šï¼Œæˆ‘ä»¬éœ€è¦ grp åº“é‡Œçš„ getgrgid() å‡½æ•°
    char *fileGrp = getgrgid(st.st_gid)->gr_name;

    // æ–‡ä»¶å¤§å°
    long int fileSize = st.st_size;

    // è·å–ä¿®æ”¹çš„æ—¶é—´
    // st.st_mtime  è·å–åˆ°çš„æ˜¯æˆ‘ä»¬long int å‹çš„æ•°æ®ï¼Œæ˜¯ä»1970å¹´åˆ°æœ€åä¸€æ¬¡ä¿®æ”¹çš„ç§’æ•°
    // æ‰€ä»¥æˆ‘ä»¬è¦ç”¨ time å¤´æ–‡ä»¶é‡Œçš„ ctimeå‡½æ•°æ¥å°†æ—¶é—´è½¬æ¢æˆæœ¬åœ°çš„æ—¶é—´
    char *time = ctime(&st.st_mtime);

    // å› ä¸ºè½¬æ¢åï¼Œä¼šåœ¨æœ«å°¾åŠ ä¸Šä¸€ä¸ª \n(æ¢è¡Œç¬¦)ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°ç»„
    // ä½¿ç”¨strncpyå‡½æ•°å°† timeæ•°ç»„çš„æ•°æ®copy åˆ°mtimeæ•°ç»„é‡Œï¼Œå¤åˆ¶çš„æ•°æ®å¤§å°ä¸º timeæ•°ç»„å¤§å°å‡1ï¼Œä»¥æ­¤æ¥å»é™¤æœ«å°¾çš„æ¢è¡Œç¬¦
    char mtime[512] = {0};
    strncpy(mtime, time, strlen(time) - 1);

    // ä¹Ÿå¯ä»¥ç›´æ¥  time[strlen(time)-1]='\0'ï¼›å»åˆ°æ¢è¡Œç¬¦

    char buf[1024];
    // sprintf æŠŠæ ¼å¼åŒ–çš„æ•°æ®å†™å…¥æŸä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œè¿™é‡Œå°±æ˜¯æŠŠæ ¼å¼åŒ–çš„æ•°æ®å†™è¿› buf é‡Œ
    // æ³¨æ„è¿™é‡Œçš„æ•°æ®ç±»å‹
    sprintf(buf, "%s %d %s %s %ld %s %s", perms, linkNum, fileUser, fileGrp, fileSize, mtime, argv[1]);
    // è¾“å‡ºå­—ç¬¦ä¸² buf
    printf("%s\n", buf);

    return 0;
}
```

![æ¨¡æ‹Ÿå®ç°-ls--l](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/æ¨¡æ‹Ÿå®ç°-ls--l.2gl2h2c4biv4.webp)

### 9ã€æ–‡ä»¶å±æ€§æ“ä½œå‡½æ•°

#### 9.1 access å‡½æ•°

> * int access(const char * pathname , int mode);

```c
#include <unistd.h>
int access(const char *pathname, int mode);
    ä½œç”¨ï¼šåˆ¤æ–­æŸä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æŸä¸ªæƒé™ï¼Œæˆ–è€…åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    å‚æ•°ï¼š
        - pathnameï¼šåˆ¤æ–­çš„æ–‡ä»¶è·¯å¾„
        - modeï¼š
            R_OKï¼šåˆ¤æ–­æ˜¯å¦æœ‰è¯»æƒé™
            W_OK: åˆ¤æ–­æ˜¯å¦æœ‰å†™æƒé™
            X_OKï¼šåˆ¤æ–­æ˜¯å¦æœ‰æ‰§è¡Œæƒé™
            F_OK: åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å› -1
```

```c
//access.c
#include <unistd.h>
#include <stdio.h>

int main()
{
    int ret = access("a.txt", F_OK);
    if (ret == -1)
    {
        perror("access");
        return -1;
    }
    printf("æ–‡ä»¶å­˜åœ¨ï¼ï¼ï¼\n");
    return 0;
}
```

![accessåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/accessåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨.203bwos4eezk.webp)



#### 9.2 chmod å‡½æ•°

> * int chmod(const char *pathname, mode_t mode);

```c
#include <sys/stat.h>
int chmod(const char *pathname, mode_t mode);
    ä¿®æ”¹æ–‡ä»¶çš„æƒé™
    å‚æ•°ï¼š
        - pathname: éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯å¾„
        - modeï¼šéœ€è¦ä¿®æ”¹çš„æƒé™å€¼ï¼Œå…«è¿›åˆ¶çš„æ•°
    è¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å› -1
```

```c
#include <sys/stat.h>
#include <stdio.h>
int main()
{
    int ret = chmod("a.txt", 0775);
    if (ret == -1)
    {
        perror("chmod");
        return -1;
    }
    return 0;
}
```

![chmod-ä¿®æ”¹æ–‡ä»¶æƒé™](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/chmod-ä¿®æ”¹æ–‡ä»¶æƒé™.3gfftl8mlyg0.webp)

#### 9.3 chown å‡½æ•°

> * **int chown(const char *path,uid_t owner , gid_t group);**

#### 9.4 truncate å‡½æ•°

> * int truncate(const char *path, off_t length)

```c
#include <unistd.h>
#include <sys/types.h>
int truncate(const char *path, off_t length);
    ä½œç”¨ï¼šç¼©å‡æˆ–è€…æ‰©å±•æ–‡ä»¶çš„å°ºå¯¸è‡³æŒ‡å®šçš„å¤§å°
    å‚æ•°ï¼š
        - pathï¼šéœ€è¦ä¿®æ”¹çš„æ–‡ä»¶çš„è·¯åŠ²
        - lengthï¼šéœ€è¦æœ€ç»ˆæ–‡ä»¶å˜æˆçš„å¤§å°
    è¿”å›å€¼ï¼š
        æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1
```

```c
//truncate.c
#include <unistd.h>
#include <sys/types.h>
#include <stdio.h>

int main()
{
    int ret = truncate("b.txt", 20);

    if (ret == -1)
    {
        perror("truncate");
        return -1;
    }
    return 0;
}
```

![ç¼©å‡æ–‡ä»¶](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/truncate-æ‰©å±•/ç¼©å‡æ–‡ä»¶.3i4dzrzfpu40.webp)

* ğŸ’›ï¼šä¸€å¼€å§‹æ–‡ä»¶å¤§å°æ˜¯12ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æŸç¬¦ï¼Œæ‰€ä»¥æ˜¯12ä¸ªï¼›
* â¤ï¼šæŠŠæ–‡ä»¶å°ºå¯¸æ‰©å±•ä¸º 20ï¼Œæ‰©å……çš„éƒ¨åˆ†ï¼ˆç©ºæ´ï¼‰åœ¨è¢«è¯»å–çš„æ—¶å€™æ˜¯å­—èŠ‚0ï¼›
* ğŸ§¡ï¼šæŠŠæ–‡ä»¶å°ºå¯¸ç¼©å‡åˆ° 5ï¼›
* ä¸Šå›¾æœ€åå¦‚æœå†æ‰§è¡Œä¸€æ¬¡ `ll b.txt` ä¼šå‘ç°å¤§å°åˆå˜æˆäº†6ï¼Œï¼ˆ**è¿™åº”è¯¥æ˜¯æˆ‘ä»¬ä½¿ç”¨ vim æ‰“å¼€å¹¶å…³é—­æ–‡ä»¶åï¼Œè‡ªåŠ¨ç»™æ·»åŠ äº†ä¸€ä¸ªç»“æŸç¬¦** ï¼ˆä¸ç¡®å®šæ˜¯ä¸æ˜¯ï¼‰ï¼‰ï¼Œè¿™é‡Œå‘ç°ï¼Œæ‰©å±•ä¸º20ï¼Œåœ¨ç”¨vim æ‰“å¼€æ–‡ä»¶å†å…³é—­ä¹Ÿä¼šæœ‰ç›¸åŒçš„æƒ…å†µå‘ç”Ÿï¼Œå³å¤§å°å˜ä¸º21



### 10ã€ç›®å½•æ“ä½œå‡½æ•°

#### 10.1 mkdir å‡½æ•°

> *  int mkdir(const char *pathname, mode_t mode);
> * åˆ›å»ºç›®å½•

```c
#include <sys/stat.h>
#include <sys/types.h>
int mkdir(const char *pathname, mode_t mode);
    ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªç›®å½•
    å‚æ•°ï¼š
        pathnameï¼šåˆ›å»ºçš„ç›®å½•çš„è·¯åŠ²
        modeï¼šæƒé™ï¼Œå…«è¿›åˆ¶çš„æ•°
    è¿”å›å€¼ï¼š
        æˆåŠŸè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1ï¼›
```

```c
#include <sys/stat.h>
#include <sys/types.h>
#include <stdio.h>

int main()
{
    // æ³¨æ„ï¼šè¿™é‡Œä¸è¦å†™æˆ 777 ï¼Œä¸ç„¶æ˜¯åè¿›åˆ¶æ•°ï¼Œ è¦å†™ 0777æ‰å¯¹
    int ret = mkdir("aaa", 0777);
    if (ret == -1)
    {
        perror("mkdir");
        return -1;
    }

    return 0;
}
```

![mkdirå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/mkdirå‡½æ•°.4nelrarfaxo0.webp)

* ğŸŸ¨ï¼šaaa æƒé™é”™è¯¯æ˜¯å› ä¸ºæˆ‘ä»¬æŠŠä»£ç å†™æˆäº† **mkdir("aaa" , 777)**ï¼›
* ğŸŸ¥ï¼šåˆ é™¤ç›®å½•è¦åŠ  -rf ï¼Œ `rm -rf aaa`  ï¼›
* ğŸ’¦ï¼šä¿®æ”¹äº†æƒé™ï¼ŒæŠŠ777 æ”¹æˆäº† 0777ï¼Œå†ç»è¿‡ä¸æƒé™æ©ç å–ååå† &ï¼ˆä¸ï¼‰ è¿ç®—ï¼Œå°±å¾—å‡ºå›¾ä¸Šçš„æƒé™



#### 10.2 rmdir å‡½æ•°

> * int rmdir( const char * pathname);
> * åˆ é™¤ç›®å½•ï¼Œåªèƒ½åˆ é™¤ç©ºç›®å½•ï¼Œå¦‚æœç›®å½•é‡Œæœ‰ä¸œè¥¿ï¼Œå°±åˆ ä¸äº†





#### 10.3 rename å‡½æ•°

> * int rename(const char *oldpath, const char *newpath);
> * ä¿®æ”¹æ–‡ä»¶å

```c
#include <stdio.h>
int rename(const char *oldpath, const char *newpath);
    å‚æ•°ï¼š
        - æ—§çš„åç§° ï¼Œæ–°çš„åç§°
    è¿”å›å€¼ ï¼š
        æˆåŠŸè¿”å› 0 ï¼Œå¤±è´¥è¿”å› -1
```

```c
#include <stdio.h>

int main()
{
    int ret = rename("aaa", "bbb");
    if (ret == -1)
    {
        perror("rename");
        return -1;
    }
    return 0;
}
```





#### 10.4 chdir å’Œ getcwd å‡½æ•°

> * int chdir(const char *path);
>   * ä¿®æ”¹å·¥ä½œç›®å½•
> * char *getcwd(char *buf, size_t size);
>   * è·å–å½“å‰å·¥ä½œç›®å½•

```c
#include <unistd.h>
int chdir(const char *path);
    ä½œç”¨ï¼šä¿®æ”¹è¿›ç¨‹çš„å·¥ä½œç›®å½•
        æ¯”å¦‚åœ¨ /home/nowcoder å¯åŠ¨äº†ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºa.out,è¿›ç¨‹çš„å·¥ä½œç›®å½• /home/nowcoder
    å‚æ•°ï¼š
        - pathï¼šéœ€è¦ä¿®æ”¹çš„å·¥ä½œç›®å½•
#include <unistd.h>
char *getcwd(char *buf, size_t size);
    ä½œç”¨ï¼š è·å–å½“å‰çš„å·¥ä½œç›®å½•
    å‚æ•°ï¼š
        - bufï¼šå­˜å‚¨çš„è·¯å¾„ï¼ŒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ•°å€¼ï¼ˆä¼ å‡ºå‚æ•°ï¼‰
        - sizeï¼šæ•°å€¼çš„å¤§å°
    è¿”å›å€¼ï¼š
        è¿”å›çš„æŒ‡å‘çš„ä¸€å—å†…å­˜ï¼Œè¿™ä¸ªæ•°æ®å°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°
```

```c
#include <unistd.h>
#include <stdio.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <fcntl.h>

int main()
{

    // è·å–å½“å‰çš„å·¥ä½œç›®å½•
    char buf[128];
    getcwd(buf, sizeof(buf));
    printf("å½“å‰çš„å·¥ä½œç›®å½•æ˜¯ï¼š%s\n", buf);

    // ä¿®æ”¹å·¥ä½œç›®å½•
    int ret = chdir("/home/nowcoder/Linux/lesson13");

    if (ret == -1)
    {
        perror("chdir");
        return -1;
    }

    // åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶
    int fd = open("chdir.txt", O_CREAT | O_RDWR, 0664);
    if (fd == -1)
    {
        perror("open");
        return -1;
    }

    //å…³é—­æ–‡ä»¶
    close(fd);

    // è·å–å½“å‰çš„å·¥ä½œç›®å½•
    char buf1[128];
    getcwd(buf1, sizeof(buf1));
    printf("å½“å‰çš„å·¥ä½œç›®å½•æ˜¯ï¼š%s\n", buf1);

    return 0;
}
```



![è·å–ä¸ä¿®æ”¹å·¥ä½œç›®å½•](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/è·å–ä¸ä¿®æ”¹å·¥ä½œç›®å½•.1d22eqy2wadc.webp)



### 11ã€ç›®å½•éå†å‡½æ•°

> * DIR *opendir(const char *name); 
>
>   * ```c
>     //æ‰“å¼€ä¸€ä¸ªç›®å½•
>         #include <sys/types.h>
>         #include <dirent.h>
>         DIR *opendir(const char *name);
>             å‚æ•°ï¼š
>                 -nameï¼šéœ€è¦æ‰“å¼€çš„ç›®å½•çš„åç§°
>             è¿”å›å€¼ï¼š
>                 DIR *ç±»å‹ï¼Œç†è§£ä¸ºç›®å½•æµ
>                 é”™è¯¯è¿”å› NULL
>     ```
>
> * struct dirent *readdir(DIR *dirp); 
>
>   * ```c
>     //è¯»å–ç›®å½•ä¸­çš„æ•°æ®
>         #include <dirent.h>
>         struct dirent *readdir(DIR *dirp);
>             - å‚æ•°ï¼š dirp æ˜¯opendirè¿”å›çš„ç»“æœ
>             -è¿”å›å€¼ï¼š
>                 struct dirent //ä»£è¡¨è¯»å–åˆ°çš„æ–‡ä»¶çš„ä¿¡æ¯
>                 //è¯»å–åˆ°äº†æœ«å°¾æˆ–è€…å¤±è´¥äº†ï¼Œè¿”å›NULL
>     ```

#### 11.1 dirent ç»“æ„ä½“å’Œ d_type

```c
struct dirent
{
	// æ­¤ç›®å½•è¿›å…¥ç‚¹çš„inodeï¼ŒèŠ‚ç‚¹  æ•´æ•°   è¡¨ç¤ºæ–‡ä»¶åœ¨è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½® 
	ino_t d_ino; 
	// ç›®å½•æ–‡ä»¶å¼€å¤´è‡³æ­¤ç›®å½•è¿›å…¥ç‚¹çš„ä½ç§»ï¼Œ åç§»é‡ ç›®å½•ä¸­çš„ä½ç½®  
	off_t d_off; 
	// d_name çš„é•¿åº¦, ä¸åŒ…å«NULLå­—ç¬¦ï¼Œæ–‡ä»¶åå®é™…çš„å¤§å°
	unsigned short int d_reclen; 
	// d_name æ‰€æŒ‡çš„æ–‡ä»¶ç±»å‹
	unsigned char d_type; 
	// æ–‡ä»¶å ï¼Œç”¨æ¥å­˜å‚¨æ–‡ä»¶å
	char d_name[256];
};

d_type:
	DT_BLK - å—è®¾å¤‡
	DT_CHR - å­—ç¬¦è®¾å¤‡
	DT_DIR - ç›®å½•
	DT_LNK - è½¯è¿æ¥
	DT_FIFO - ç®¡é“
	DT_REG - æ™®é€šæ–‡ä»¶
	DT_SOCK - å¥—æ¥å­—
	DT_UNKNOWN - æœªçŸ¥

```



> * int closedir(DIR *dirp);
>
>   * ```c
>     //å…³é—­ç›®å½•
>         #include <sys/types.h>
>         #include <dirent.h>
>         int closedir(DIR *dirp);
>              - å‚æ•°ï¼š dirp æ˜¯opendirè¿”å›çš„ç»“æœ
>     ```

#### 11.2 è·å–æŒ‡å®šç›®å½•ä¸‹æ™®é€šæ–‡ä»¶çš„æ•°é‡

```c
//readFileNum.c
#include <sys/types.h>
#include <dirent.h>
#include <stdio.h>
#include <string.h> //strcmp(),sprintf()
#include <stdlib.h> //exit()

int getFileNum(const char *path);//å£°æ˜å‡½æ•°

// è¯»å–æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
int main(int argc, char *argv[])
{

    if (argc < 2)
    {
        printf("%s path\n", argv[0]);
        return -1;
    }

    int num = getFileNum(argv[1]);
    printf("æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°ä¸ºï¼š%d\n", num);
    return 0;
}

// ç”¨äºè·å–ç›®å½•ä¸‹æ‰€æœ‰æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
// æˆ‘ä»¬ä¼ å…¥è¿›å»çš„è¿™ä¸ªå‚æ•°ä¸éœ€è¦è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥åŠ ä¸ª const
int getFileNum(const char *path)
{
    // 1.æ‰“å¼€ç›®å½•
    DIR *dir = opendir(path);

    if (dir == NULL)
    {
        perror("opendir");
        exit(0);
    }

    struct dirent *ptr;

    // è®°å½•æ™®é€šæ–‡ä»¶çš„ä¸ªæ•°
    int total = 0;

    while ((ptr = readdir(dir)) != NULL)
    {
        // è·å–åç§°
        char *dname = ptr->d_name;

        // å¿½ç•¥æ‰ . å’Œ ..
        // strcmp() æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œå¦‚æœç›¸ç­‰è¿”å›0
        if (strcmp(dname, ".") == 0 || strcmp(dname, "..") == 0)
        {
            continue;
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯æ™®é€šæ–‡ä»¶è¿˜æ˜¯ç›®å½•
        // è¿™é‡Œ DT_DIR åœ¨vscodeé‡Œå†™æ—¶ä¼šæ˜¾ç¤ºæœªå®šä¹‰ï¼Œåº”è¯¥æ˜¯ç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘ä»¬gccç¼–è¯‘æ˜¯èƒ½æ­£å¸¸çš„
        if (ptr->d_type == DT_DIR)
        {
            // ç›®å½•ï¼Œéœ€è¦ç»§ç»­è¯»å–è¯»å–æ•´ä¸ªç›®å½•
            char newpath[256];
            sprintf(newpath, "%s/%s", path, dname);
            total += getFileNum(newpath);
        }

        if (ptr->d_type == DT_REG)
        {
            // æ™®é€šæ–‡ä»¶
            total++;
        }
    }
    // å…³é—­ç›®å½•
    closedir(dir);
    return total;
}
```

![è·å–æ™®é€šæ–‡ä»¶æ•°é‡](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/è·å–æ™®é€šæ–‡ä»¶æ•°é‡.3jqkwwl568w0.webp)

* ğŸŸ¡ï¼š**æ²¡æœ‰ä¼ å…¥å‚æ•°**ï¼ˆç›®å½•è·¯å¾„ï¼‰
* ğŸ”´ï¼šæ­£å¸¸è¿è¡ŒæŸ¥çœ‹
* ğŸŸ¢ï¼šæ²¡æœ‰æƒé™/æ‹’ç»è®¿é—®
* ğŸŒ¬ï¼šæˆ‘ä»¬ç”¨ `ll`å‘½ä»¤ä¼šå‘ç°ï¼Œä¸€ä¸ªç›®å½•é‡Œé™¤äº†æœ¬æ¥åˆçš„æ–‡ä»¶æˆ–å­ç›®å½•å¤–è¿˜æœ‰ `./`(å½“å‰ç›®å½•) ï¼Œ`../`ï¼ˆä¸Šä¸€çº§ç›®å½•ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»£ç é‡Œï¼Œéœ€è¦é™¤å¼€è¿™ä¸¤ä¸ªç›®å½•,æ³¨æ„ï¼šæˆ‘ä»¬åˆ¤æ–­æ—¶ç›´æ¥åˆ¤æ–­      **`.`**      å’Œ     **`..`**     å°±è¡Œ ï¼Œè€Œä¸æ˜¯ **`./`** å’Œ **`../`**



### 12ã€dupã€dup2 å‡½æ•°

#### 12.1 dup() å‡½æ•°

> * int dup(int oldfd);
>   * å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦
>
> ```c
> #include <unistd.h>
> int dup(int oldfd);
>     ä½œç”¨ï¼šå¤åˆ¶ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦
>         fd=3ï¼Œint fd1 = dup(fd),
>         fdæŒ‡å‘çš„æ˜¯ a.txt ,fd1ä¹Ÿæ˜¯æŒ‡å‘ a.txt
>         ä»ç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦è¡¨é‡Œæ‰¾ä¸€ä¸ªæœ€å°çš„ï¼Œä½œä¸ºæ–°çš„æ‹·è´çš„æ–‡ä»¶æè¿°ç¬¦
>     å‚æ•°ï¼š
>     è¿”å›å€¼ï¼š
> int dup2(int oldfd, int newfd);
> ```

```c
//dup.c
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <string.h>

int main()
{
    int fd = open("a.txt", O_RDWR | O_CREAT, 0664);
    int fd1 = dup(fd);

    if (fd1 == -1)
    {
        perror("dup");
        return -1;
    }
    printf("fd : %d , fd1 : %d\n", fd, fd1);
    
	//å…³é—­ fd
    close(fd);
    char *str = "hello,world";
    int ret = write(fd1, str, strlen(str));
    if (ret == -1)
    {
        perror("write");
        return -1;
    }
	//å…³é—­ fd1
    close(fd1);
    return 0;
}
```

![dupå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/dupå‡½æ•°.582zbd0s7hg.webp)

* a.txt ä¼šè¢«æ”¹å˜ï¼Œ**ç›¸å½“äºæŠŠ a.txt çš„æ–‡ä»¶ä¿¡æ¯åˆå¤åˆ¶äº†ä¸€ä»½**ï¼Œä»ç©ºé—²çš„æ–‡ä»¶æè¿°ç¬¦è¡¨é‡Œæ‰¾ä¸€ä¸ªæœ€å°çš„ï¼Œä½œä¸ºæ–°çš„æ‹·è´çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå­˜æ”¾åˆ°æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ `fd1` ä¿®æ”¹æ–‡ä»¶ï¼Œä¹Ÿä¼šä¿®æ”¹ `a.txt`æ–‡ä»¶

#### 12.2 dup2() å‡½æ•°

> * int dup2(int oldfd, int newfd);
>   * é‡å®šå‘æ–‡ä»¶æè¿°ç¬¦
>
> ```c
> #include <unistd.h>
> int dup2(int oldfd, int newfd);
>     ä½œç”¨ï¼šé‡å®šå‘æ–‡ä»¶æè¿°ç¬¦
>     //oldfd æŒ‡å‘ a.txt,newfd æŒ‡å‘ b.txt
>     //è°ƒç”¨å‡½æ•°æˆåŠŸåï¼š newfd å’Œ b.txt åš ğŸ’›closeğŸ’–ï¼Œnewfd æŒ‡å‘äº† a.txt
>     //ï¼ˆè¿™é‡Œå¹¶ä¸æ˜¯æŠŠnewfdçš„å€¼æ”¹æˆ oldfdçš„å€¼ï¼Œè€Œæ˜¯è¯´ newfd æŒ‡å‘çš„ä¿¡æ¯ä¸å†æ˜¯ b.txtè€Œæ˜¯ a.txtï¼‰
>     //oldfd å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦
>     //å¦‚æœoldfd å’Œ newfdå€¼ç›¸åŒï¼Œç›¸å½“äºä»€ä¹ˆéƒ½æ²¡åš
> 	è¿”å›å€¼ï¼šnewfd
> ```

```c
//dup2.c
#include <unistd.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <string.h>

int main()
{

    int fd1 = open("1.txt", O_RDWR | O_CREAT, 0664);
    if (fd1 == -1)
    {
        perror("open");
        return -1;
    }

    int fd2 = open("2.txt", O_RDWR | O_CREAT, 0664);
    if (fd2 == -1)
    {
        perror("open");
        return -1;
    }

    printf("fd1 : %d, fd2 : %d\n", fd1, fd2);

    // è¿”å›å€¼æ˜¯ newfdçš„å€¼ ï¼Œæ‰€ä»¥ fd å’Œfd2 ç›¸ç­‰
    int fd = dup2(fd1, fd2);
    if (fd == -1)
    {
        perror("dup2");
        return -1;
    }

    // é€šè¿‡fd2å»å†™æ•°æ®ï¼Œå®é™…æ“ä½œçš„æ˜¯ 1.txtï¼Œè€Œä¸æ˜¯2.txt
    char *str = "hello, dup2";
    int len = write(fd2, str, strlen(str));

    if (len == -1)
    {
        perror("write");
        return -1;
    }

    printf("fd1 : %d, fd2 : %d,fd : %d\n", fd1, fd2, fd);

    // å› ä¸ºfd å’Œ fd2æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…³é—­ä¸€ä¸ªå°±å¯ä»¥
    close(fd1); // å…³é—­äº† fd1æŒ‡å‘çš„a.txtæ–‡ä»¶
    close(fd2); // åŒä¸Š

    return 0;
}
```

![dup2å‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/dup2å‡½æ•°.4cct5j10zfm0.webp)

* å¯ä»¥çœ‹å‡º `dup2()` çš„è¿”å›å€¼æ˜¯ `newfd`
* è¿™é‡Œ `fd2`å¯¹ `2.txt`çš„æŒ‡å‘è¢«å…³é—­ï¼Œç„¶åè¢«æŒ‡å‘äº† `fd1`æŒ‡å‘çš„ `1.txt`ï¼Œæ‰€ä»¥æ•°æ®å†™è¿›äº† `1.txt` é‡Œ





### 13ã€fcntl() å‡½æ•°

> * int fcntl(int fd, int cmd, ... /* arg */ ); 
>   * å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ è®¾ç½®/è·å–æ–‡ä»¶çš„çŠ¶æ€æ ‡å¿—
>
> ```c
> #include <unistd.h>
> #include <fcntl.h>
> 
> int fcntl(int fd, int cmd, ... arg );
>     å‚æ•°ï¼š
>         fd : è¡¨ç¤ºéœ€è¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦
>         cmd ï¼š è¡¨ç¤ºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œä»€ä¹ˆæ“ä½œ
>             - F_DUPFD å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦,å¤åˆ¶çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•° fdï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆè¿”å›å€¼ï¼‰
>                 int ret = fcntl(fd,F_DUPFD);
> 
>             - F_GETFL : è·å–æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€ flag
>                 è·å–çš„flagå’Œæˆ‘ä»¬é€šè¿‡openå‡½æ•°ä¼ é€’çš„flagæ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚
> 
>             -F_SETFL : è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ–‡ä»¶çŠ¶æ€ flag
>                 å¿…é€‰é¡¹ï¼šO_RDONLY,O_WRONLY,O_RDWR ä¸å¯ä»¥è¢«ä¿®æ”¹
>                 å¯é€‰é¡¹ï¼šO_APPEND, O_NONBLOCK
>                     O_APPEND è¡¨ç¤ºè¿½åŠ æ•°æ®
>                     O_NONBLOCK è®¾ç½®æˆéé˜»å¡
> 
>          //é˜»å¡å’Œéé˜»å¡ï¼šæè¿°çš„æ˜¯å‡½æ•°è°ƒç”¨çš„è¡Œä¸ºã€‚
> ```



```c
#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>
#include <string.h>

int main()
{

    // 1.å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦å†™æ³•ï¼š
    // int fd = open("1.txt",O_RDONLY);
    // int ret = fcntl(fd,F_DUPFD);

    // 2.ä¿®æ”¹æˆ–è€…è·å–æ–‡ä»¶çŠ¶æ€çš„flag
    // è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç”¨O_RDONLYï¼Œè¦ç”¨O_RDWRï¼Œå› ä¸ºæˆ‘ä»¬ä¸‹é¢è®¾ç½®O_APPEND åªæ˜¯å¾€åé¢é‡Œè¿½åŠ ï¼Œè€Œä¸æ˜¯æœ‰å†™çš„æƒé™
    int fd = open("1.txt", O_RDWR);
    if (fd == -1)
    {
        perror("open");
        return -1;
    }

    // è·å–æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€ flag
    int flag = fcntl(fd, F_GETFL);
    if (flag == -1)
    {
        perror("fcntl");
        return -1;
    }
    //å¿…é¡»ä»¥è¿™ç§æ–¹å¼å»ä¿®æ”¹æƒé™ï¼Œè€Œä¸èƒ½ç›´æ¥å°±è®¾ç½®O_APPENDï¼Œä¸ç„¶åŸå…ˆçš„æƒé™å°±è¢«è¦†ç›–äº†
    flag |= O_APPEND; // flag = flag | O_APPEND;

    // ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€çš„flagï¼Œç»™flagåŠ å…¥ O_APPEND è¿™ä¸ªæ ‡è®°
    int ret = fcntl(fd, F_SETFL, flag); // å¦‚æœ ret =-1ï¼Œå°±è¯´æ˜è°ƒç”¨ fcntlå¤±è´¥
    if (ret == -1)
    {
        perror("fcntl");
        return -1;
    }

    char *str = "nihao";
    write(fd, str, strlen(str));
    close(fd);
    return 0;
}
```

![fcntlå‡½æ•°](https://cdn.staticaly.com/gh/JackCin877/image-hosting@master/Linux/fcntlå‡½æ•°.r3p2i2j1jls.webp)

* ç»™ 1.txtæ–‡ä»¶æœ«å°¾è¿½åŠ äº†æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ç”¨ O_WRONLY æ¥ç»™æ–‡ä»¶å†™å…¥æ•°æ®ï¼Œé‚£å°±æ˜¯ä»æ–‡ä»¶å¼€å¤´å†™å…¥ï¼Œä¼šæŠŠæ–‡ä»¶åŸå…ˆçš„å†…å®¹è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨æœ«å°¾å†™æ•°æ®ï¼Œè¦ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦ï¼Œå¼€å¯**O_APPEND** çš„æƒé™